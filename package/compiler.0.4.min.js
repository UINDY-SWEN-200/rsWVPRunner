/*This is a combined, compressed file.  Look at https://bitbucket.org/davidscherer/glowscript for source code and copyright information.*/(function(){})(),function(){var a={options:{version:185},hostGlobal:this};Narcissus=a}(),Narcissus.definitions=function(){function o(a,b,c,d,e){Object.defineProperty(a,b,{get:c,configurable:!d,enumerable:!e})}function p(a,b,c,d,e,f){Object.defineProperty(a,b,{get:c,set:d,configurable:!e,enumerable:!f})}function q(a,b,c,d,e){Object.defineProperty(a,b,{get:function(){var f=c();return r(a,b,f,d,!0,e),f},configurable:!0,enumerable:!e})}function r(a,b,c,d,e,f){Object.defineProperty(a,b,{value:c,writable:!e,configurable:!d,enumerable:!f})}function s(a){return typeof a=="function"&&a.toString().match(/\[native code\]/)}function t(a,b){while(a){if({}.hasOwnProperty.call(a,b))return Object.getOwnPropertyDescriptor(a,b);a=Object.getPrototypeOf(a)}}function u(a){var b=Object.create(null,{});while(a){var c=Object.getOwnPropertyNames(a);for(var d=0,e=c.length;d<e;d++)b[c[d]]=!0;a=Object.getPrototypeOf(a)}return Object.keys(b)}function v(a){var b={};for(var c in Object.getOwnPropertyNames(a))b[c]=Object.getOwnPropertyDescriptor(a,c);return b}function w(a,b){var c=Object.create(null,{}),d=E.create(b).mapObject(function(a){return c});return z(d,a)}function x(a,b){var c=Object.create(null,{}),d=E.create(b).mapObject(function(b){return a});return z(d,c)}function y(a,b){var c=A(a),d=c.defineProperty;return c.defineProperty=function(a,c){if(!c.enumerable)throw new Error("mirror property must be enumerable");if(!c.configurable)throw new Error("mirror property must be configurable");if(c.writable!==b)throw new Error("mirror property must "+(b?"":"not ")+"be writable");d(a,c)},c.fix=function(){},c.getOwnPropertyDescriptor=c.getPropertyDescriptor,c.getOwnPropertyNames=u.bind(c,a),c.keys=c.enumerate,c["delete"]=function(){return!1},c.hasOwn=c.has,c}function z(a,b){function c(c){return D(a,c)?a[c]:b}function d(a){var b=t(c(a),a);return b&&(b.configurable=!0),b}function e(){var c=Object.getOwnPropertyNames(a).filter(function(b){return b in a[b]}),d=u(b).filter(function(b){return!D(a,b)});return c.concat(d)}function f(){var c=Object.getOwnPropertyNames(a).filter(function(b){return b in a[b]});for(l in b)D(a,l)||c.push(l);return c}function g(a){return a in c(a)}return{getOwnPropertyDescriptor:d,getPropertyDescriptor:d,getOwnPropertyNames:e,defineProperty:function(a,b){Object.defineProperty(c(a),a,b)},"delete":function(a){var b=c(a);return delete b[a]},fix:function(){},has:g,hasOwn:g,get:function(a,b){var d=c(b);return d[b]},set:function(a,b,d){var e=c(b);return e[b]=d,!0},enumerate:f,keys:f}}function A(a){return{getOwnPropertyDescriptor:function(b){var c=Object.getOwnPropertyDescriptor(a,b);return c.configurable=!0,c},getPropertyDescriptor:function(b){var c=t(a,b);return c.configurable=!0,c},getOwnPropertyNames:function(){return Object.getOwnPropertyNames(a)},defineProperty:function(b,c){Object.defineProperty(a,b,c)},"delete":function(b){return delete a[b]},fix:function(){return Object.isFrozen(a)?v(a):undefined},has:function(b){return b in a},hasOwn:function(b){return{}.hasOwnProperty.call(a,b)},get:function(b,c){return a[c]},set:function(b,c,d){return a[c]=d,!0},enumerate:function(){var b=[];for(l in a)b.push(l);return b},keys:function(){return Object.keys(a)}}}function B(){return undefined}function D(a,b){return C.call(a,b)}function E(a,b){this.table=a||Object.create(null,{}),this.size=b||0}function F(a){this.array=a||[]}function G(a,b,c,d){var e=a.array;for(var f=0,g=e.length;f<g;f++){var h=e[f];if(h.key===b)return c(h,f)}return d()}function H(a){this.elts=a||null}var a=["END","\n",";",",","=","?",":","CONDITIONAL","||","&&","|","^","&","==","!=","===","!==","<","<=",">=",">","<<",">>",">>>","+","-","*","/","%","!","~","UNARY_PLUS","UNARY_MINUS","++","--",".","[","]","{","}","(",")","SCRIPT","BLOCK","LABEL","FOR_IN","CALL","NEW_WITH_ARGS","INDEX","ARRAY_INIT","OBJECT_INIT","PROPERTY_INIT","GETTER","SETTER","GROUP","LIST","LET_BLOCK","ARRAY_COMP","GENERATOR","COMP_TAIL","IDENTIFIER","NUMBER","STRING","REGEXP","break","case","catch","const","continue","debugger","default","delete","do","else","export","false","finally","for","function","if","import","in","instanceof","let","module","new","null","return","switch","this","throw","true","try","typeof","var","void","yield","while","with"],b=["break","const","continue","debugger","do","for","if","return","switch","throw","try","var","yield","while","with"],c=["\t","","\f"," "," ","﻿"," ","᠎"," "," "," "," "," "," "," "," "," "," "," "," "," ","　"],d={};for(var e=0;e<c.length;e++)d[c[e]]=!0;var f={"\n":"NEWLINE",";":"SEMICOLON",",":"COMMA","?":"HOOK",":":"COLON","||":"OR","&&":"AND","|":"BITWISE_OR","^":"BITWISE_XOR","&":"BITWISE_AND","===":"STRICT_EQ","==":"EQ","=":"ASSIGN","!==":"STRICT_NE","!=":"NE","<<":"LSH","<=":"LE","<":"LT",">>>":"URSH",">>":"RSH",">=":"GE",">":"GT","++":"INCREMENT","--":"DECREMENT","+":"PLUS","-":"MINUS","*":"MUL","/":"DIV","%":"MOD","!":"NOT","~":"BITWISE_NOT",".":"DOT","[":"LEFT_BRACKET","]":"RIGHT_BRACKET","{":"LEFT_CURLY","}":"RIGHT_CURLY","(":"LEFT_PAREN",")":"RIGHT_PAREN"},g={__proto__:null},h={},i="const ";for(var e=0,j=a.length;e<j;e++){e>0&&(i+=", ");var k=a[e],l;/^[a-z]/.test(k)?(l=k.toUpperCase(),g[k]=e):l=/^\W/.test(k)?f[k]:k,i+=l+" = "+e,h[l]=e,a[k]=e}i+=";";var m={__proto__:null};for(e=0,j=b.length;e<j;e++)m[g[b[e]]]=!0;var n=["|","^","&","<<",">>",">>>","+","-","*","/","%"];for(e=0,j=n.length;e<j;e++)k=n[e],n[k]=a[k];var C={}.hasOwnProperty;return E.create=function(a){var b=Object.create(null,{}),c=0,d=Object.getOwnPropertyNames(a);for(var e=0,f=d.length;e<f;e++){var g=d[e];b[g]=a[g],c++}return new E(b,c)},E.prototype={has:function(a){return C.call(this.table,a)},set:function(a,b){C.call(this.table,a)||this.size++,this.table[a]=b},get:function(a){return this.table[a]},getDef:function(a,b){return C.call(this.table,a)||(this.size++,this.table[a]=b()),this.table[a]},forEach:function(a){var b=this.table;for(var c in b)a.call(this,c,b[c])},map:function(a){var b=this.table,c=Object.create(null,{});return this.forEach(function(b,d){c[b]=a.call(this,d,b)}),new E(c,this.size)},mapObject:function(a){var b=this.table,c=Object.create(null,{});return this.forEach(function(b,d){c[b]=a.call(this,d,b)}),c},toObject:function(){return this.mapObject(function(a){return a})},choose:function(){return Object.getOwnPropertyNames(this.table)[0]},remove:function(a){C.call(this.table,a)&&(this.size--,delete this.table[a])},copy:function(){var a=Object.create(null,{});for(var b in this.table)a[b]=this.table[b];return new E(a,this.size)},toString:function(){return"[object StringMap]"}},F.prototype={has:function(a){return G(this,a,function(){return!0},function(){return!1})},set:function(a,b){var c=this.array;G(this,a,function(a){a.value=b},function(){c.push({key:a,value:b})})},get:function(a){return G(this,a,function(a){return a.value},function(){return null})},getDef:function(a,b){var c=this.array;return G(this,a,function(a){return a.value},function(){var d=b();return c.push({key:a,value:d}),d})},forEach:function(a){var b=this.array;for(var c=0,d=b.length;c<d;c++){var e=b[c];a.call(this,e.key,e.value)}},choose:function(){return this.array[0].key},get size(){return this.array.length},remove:function(a){var b=this.array;G(this,a,function(a,c){b.splice(c,1)},function(){})},copy:function(){return new F(this.array.map(function(a){return{key:a.key,value:a.value}}))},clear:function(){this.array=[]},toString:function(){return"[object ObjectMap]"}},H.prototype={push:function(a){return new H({top:a,rest:this.elts})},top:function(){if(!this.elts)throw new Error("empty stack");return this.elts.top},isEmpty:function(){return this.top===null},find:function(a){for(var b=this.elts;b;b=b.rest)if(a(b.top))return b.top;return null},has:function(a){return Boolean(this.find(function(b){return b===a}))},forEach:function(a){for(var b=this.elts;b;b=b.rest)a(b.top)}},{tokens:a,whitespace:d,opTypeNames:f,keywords:g,isStatementStartCode:m,tokenIds:h,consts:i,assignOps:n,defineGetter:o,defineGetterSetter:p,defineMemoGetter:q,defineProperty:r,isNativeCode:s,mirrorHandler:y,mixinHandler:z,whitelistHandler:x,blacklistHandler:w,makePassthruHandler:A,noPropFound:B,StringMap:E,ObjectMap:F,Stack:H}}(),Narcissus.lexer=function(){function Tokenizer(a,b,c){this.cursor=0,this.source=String(a),this.tokens=[],this.tokenIndex=0,this.lookahead=0,this.scanNewlines=!1,this.unexpectedEOF=!1,this.filename=b||"",this.lineno=c||1}var definitions=Narcissus.definitions;eval(definitions.consts);var opTokens={};for(var op in definitions.opTypeNames){if(op==="\n"||op===".")continue;var node=opTokens;for(var i=0;i<op.length;i++){var ch=op[i];ch in node||(node[ch]={}),node=node[ch],node.op=op}}return Tokenizer.prototype={match:function(a,b){return this.get(b)===a||this.unget()},mustMatch:function(a){if(!this.match(a))throw this.newSyntaxError("Missing "+definitions.tokens[a].toLowerCase());return this.token},peek:function(a){var b,c;return this.lookahead?(c=this.tokens[this.tokenIndex+this.lookahead&3],b=this.scanNewlines&&c.lineno!==this.lineno?NEWLINE:c.type):(b=this.get(a),this.unget()),b},peekOnSameLine:function(a){this.scanNewlines=!0;var b=this.peek(a);return this.scanNewlines=!1,b},skip:function(){var a=this.source;for(;;){var b=a[this.cursor++],c=a[this.cursor];if(b==="\r"){if(c==="\n")continue;b="\n"}if(b==="\n"&&!this.scanNewlines)this.lineno++;else if(b==="/"&&c==="*"){this.cursor++;for(;;){b=a[this.cursor++];if(b===undefined)throw this.newSyntaxError("Unterminated comment");if(b==="*"){c=a[this.cursor];if(c==="/"){this.cursor++;break}}else b==="\n"&&this.lineno++}}else if(b==="/"&&c==="/"){this.cursor++;for(;;){b=a[this.cursor++],c=a[this.cursor];if(b===undefined)return;b==="\r"&&c!=="\n"&&(b="\n");if(b==="\n"){this.scanNewlines?this.cursor--:this.lineno++;break}}}else if(!(b in definitions.whitespace)){this.cursor--;return}}},lexExponent:function(){var a=this.source,b=a[this.cursor];if(b==="e"||b==="E"){this.cursor++,ch=a[this.cursor++];if(ch==="+"||ch==="-")ch=a[this.cursor++];if(ch<"0"||ch>"9")throw this.newSyntaxError("Missing exponent");do ch=a[this.cursor++];while(ch>="0"&&ch<="9");return this.cursor--,!0}return!1},lexZeroNumber:function(a){var b=this.token,c=this.source;b.type=NUMBER,a=c[this.cursor++];if(a==="."){do a=c[this.cursor++];while(a>="0"&&a<="9");this.cursor--,this.lexExponent(),b.value=parseFloat(c.substring(b.start,this.cursor))}else if(a==="x"||a==="X"){do a=c[this.cursor++];while(a>="0"&&a<="9"||a>="a"&&a<="f"||a>="A"&&a<="F");this.cursor--,b.value=parseInt(c.substring(b.start,this.cursor))}else if(a>="0"&&a<="7"){do a=c[this.cursor++];while(a>="0"&&a<="7");this.cursor--,b.value=parseInt(c.substring(b.start,this.cursor))}else this.cursor--,this.lexExponent(),b.value=0},lexNumber:function(a){var b=this.token,c=this.source;b.type=NUMBER;var d=!1;do a=c[this.cursor++],a==="."&&!d&&(d=!0,a=c[this.cursor++]);while(a>="0"&&a<="9");this.cursor--;var e=this.lexExponent();d=d||e;var f=c.substring(b.start,this.cursor);b.value=d?parseFloat(f):parseInt(f)},lexDot:function(a){var b=this.token,c=this.source,d=c[this.cursor];if(d>="0"&&d<="9"){do a=c[this.cursor++];while(a>="0"&&a<="9");this.cursor--,this.lexExponent(),b.type=NUMBER,b.value=parseFloat(c.substring(b.start,this.cursor))}else b.type=DOT,b.assignOp=null,b.value="."},lexString:function(ch){var token=this.token,input=this.source;token.type=STRING;var hasEscapes=!1,delim=ch;while((ch=input[this.cursor++])!==delim){if(this.cursor==input.length)throw this.newSyntaxError("Unterminated string literal");if(ch==="\\"){hasEscapes=!0;if(++this.cursor==input.length)throw this.newSyntaxError("Unterminated string literal")}}token.value=hasEscapes?eval(input.substring(token.start,this.cursor)):input.substring(token.start+1,this.cursor-1)},lexRegExp:function(ch){var token=this.token,input=this.source;token.type=REGEXP;do{ch=input[this.cursor++];if(ch==="\\")this.cursor++;else if(ch==="["){do{if(ch===undefined)throw this.newSyntaxError("Unterminated character class");ch==="\\"&&this.cursor++,ch=input[this.cursor++]}while(ch!=="]")}else if(ch===undefined)throw this.newSyntaxError("Unterminated regex")}while(ch!=="/");do ch=input[this.cursor++];while(ch>="a"&&ch<="z");this.cursor--,token.value=eval(input.substring(token.start,this.cursor))},lexOp:function(a){var b=this.token,c=this.source,d=opTokens[a],e=c[this.cursor];e in d&&(d=d[e],this.cursor++,e=c[this.cursor],e in d&&(d=d[e],this.cursor++,e=c[this.cursor]));var f=d.op;definitions.assignOps[f]&&c[this.cursor]==="="?(this.cursor++,b.type=ASSIGN,b.assignOp=definitions.tokenIds[definitions.opTypeNames[f]],f+="="):(b.type=definitions.tokenIds[definitions.opTypeNames[f]],b.assignOp=null),b.value=f},lexIdent:function(a){var b=this.token,c=this.source;do a=c[this.cursor++];while(a>="a"&&a<="z"||a>="A"&&a<="Z"||a>="0"&&a<="9"||a==="$"||a==="_");this.cursor--;var d=c.substring(b.start,this.cursor);b.type=definitions.keywords[d]||IDENTIFIER,b.value=d},get:function(a){var b;while(this.lookahead){--this.lookahead,this.tokenIndex=this.tokenIndex+1&3,b=this.tokens[this.tokenIndex];if(b.type!==NEWLINE||this.scanNewlines)return b.type}this.skip(),this.tokenIndex=this.tokenIndex+1&3,b=this.tokens[this.tokenIndex],b||(this.tokens[this.tokenIndex]=b={});var c=this.source;if(this.cursor===c.length)return b.type=END;b.start=this.cursor,b.lineno=this.lineno;var d=c[this.cursor++];if(d>="a"&&d<="z"||d>="A"&&d<="Z"||d==="$"||d==="_")this.lexIdent(d);else if(a&&d==="/")this.lexRegExp(d);else if(d in opTokens)this.lexOp(d);else if(d===".")this.lexDot(d);else if(d>="1"&&d<="9")this.lexNumber(d);else if(d==="0")this.lexZeroNumber(d);else if(d==='"'||d==="'")this.lexString(d);else{if(!this.scanNewlines||d!=="\n"&&d!=="\r")throw this.newSyntaxError("Illegal token");d==="\r"&&c[this.cursor]==="\n"&&this.cursor++,b.type=NEWLINE,b.value="\n",this.lineno++}return b.end=this.cursor,b.type},unget:function(){if(++this.lookahead===4)throw"PANIC: too much lookahead!";this.tokenIndex=this.tokenIndex-1&3},newSyntaxError:function(a){var b=new SyntaxError(a,this.filename,this.lineno);return b.source=this.source,b.cursor=this.lookahead?this.tokens[this.tokenIndex+this.lookahead&3].start:this.cursor,b}},Object.defineProperty(Tokenizer.prototype,"done",{get:function(){return this.peek(!0)===END}}),Object.defineProperty(Tokenizer.prototype,"token",{get:function(){return this.tokens[this.tokenIndex]}}),{Tokenizer:Tokenizer}}(),Narcissus.parser=function(){function pushDestructuringVarDecls(a,b){for(var c in a){var d=a[c];d.type===IDENTIFIER?b.varDecls.push(d):pushDestructuringVarDecls(d,b)}}function StaticContext(a,b,c,d){this.parentScript=a,this.parentBlock=b||a,this.inModule=c||!1,this.inFunction=d||!1,this.inForLoopInit=!1,this.topLevel=!0,this.allLabels=new Stack,this.currentLabels=new Stack,this.labeledTargets=new Stack,this.defaultLoopTarget=null,this.defaultTarget=null,this.blackList=blackLists[Narcissus.options.version],Narcissus.options.ecma3OnlyMode&&(this.ecma3OnlyMode=!0),Narcissus.options.parenFreeMode&&(this.parenFreeMode=!0)}function Script(a,b,c){var d=new Node(a,scriptInit());return Statements(a,new StaticContext(d,d,b,c),d),d}function Node(a,b){var c=a.token;c?(this.type=c.type,this.value=c.value,this.lineno=c.lineno,this.start=c.start,this.end=c.end):this.lineno=a.lineno,this.tokenizer=a,this.children=[];for(var d in b)this[d]=b[d]}function tokenString(a){var b=definitions.tokens[a];return/^\W/.test(b)?definitions.opTypeNames[b]:b.toUpperCase()}function blockInit(){return{type:BLOCK,varDecls:[]}}function scriptInit(){return{type:SCRIPT,funDecls:[],varDecls:[],modDefns:new StringMap,modAssns:new StringMap,modDecls:new StringMap,modLoads:new StringMap,impDecls:[],expDecls:[],exports:new StringMap,hasEmptyReturn:!1,hasReturnWithValue:!1,isGenerator:!1}}function MaybeLeftParen(a,b){return b.parenFreeMode?a.match(LEFT_PAREN)?LEFT_PAREN:END:a.mustMatch(LEFT_PAREN).type}function MaybeRightParen(a,b){b===LEFT_PAREN&&a.mustMatch(RIGHT_PAREN)}function Statements(a,b,c){try{while(!a.done&&a.peek(!0)!==RIGHT_CURLY)c.push(Statement(a,b))}catch(d){throw a.done&&(a.unexpectedEOF=!0),d}}function Block(a,b){a.mustMatch(LEFT_CURLY);var c=new Node(a,blockInit());return Statements(a,b.update({parentBlock:c}).pushTarget(c),c),a.mustMatch(RIGHT_CURLY),c}function Export(a,b){this.node=a,this.isDefinition=b,this.resolved=null}function registerExport(a,b){function c(b,c){if(a.has(b))throw new SyntaxError("multiple exports of "+b);a.set(b,c)}switch(b.type){case MODULE:case FUNCTION:c(b.name,new Export(b,!0));break;case VAR:for(var d=0;d<b.children.length;d++)c(b.children[d].name,new Export(b.children[d],!0));break;case LET:case CONST:throw new Error("NYI: "+definitions.tokens[b.type]);case EXPORT:for(var d=0;d<b.pathList.length;d++){var e=b.pathList[d];switch(e.type){case OBJECT_INIT:for(var f=0;f<e.children.length;f++){var g=e.children[f];g.type===IDENTIFIER?c(g.value,new Export(g,!1)):c(g.children[0].value,new Export(g.children[1],!1))}break;case DOT:c(e.children[1].value,new Export(e,!1));break;case IDENTIFIER:c(e.value,new Export(e,!1));break;default:throw new Error("unexpected export path: "+definitions.tokens[e.type])}}break;default:throw new Error("unexpected export decl: "+definitions.tokens[exp.type])}}function Module(a){var b=a.body.exports,c=a.body.modDefns,d=new StringMap;b.forEach(function(a,b){var e=b.node;if(e.type===MODULE)d.set(a,e);else if(!b.isDefinition&&e.type===IDENTIFIER&&c.has(e.value)){var f=c.get(e.value);d.set(a,f)}}),this.node=a,this.exports=b,this.exportedModules=d}function Statement(a,b){var c,d,e,f,g,h,i,j=a.get(!0),k,l,m;if(b.blackList[j])throw a.newSyntaxError(definitions.tokens[j]+" statements only allowed in Harmony");if(!b.allow(j))throw a.newSyntaxError(definitions.tokens[j]+" statement in illegal context");switch(j){case IMPORT:e=new Node(a),e.pathList=ImportPathList(a,b),b.parentScript.impDecls.push(e);break;case EXPORT:switch(a.peek()){case MODULE:case FUNCTION:case LET:case VAR:case CONST:return e=Statement(a,b),e.exported=!0,b.parentScript.expDecls.push(e),registerExport(b.parentScript.exports,e),e;default:e=new Node(a),e.pathList=ExportPathList(a,b)}b.parentScript.expDecls.push(e),registerExport(b.parentScript.exports,e);break;case MODULE:e=new Node(a),a.mustMatch(IDENTIFIER),d=a.token.value;if(a.match(LEFT_CURLY))return e.name=d,e.body=Script(a,!0,!1),e.module=new Module(e),a.mustMatch(RIGHT_CURLY),b.parentScript.modDefns.set(e.name,e),e;return a.unget(),ModuleVariables(a,b,e),e;case FUNCTION:return FunctionDefinition(a,b,!0,b.topLevel?DECLARED_FORM:STATEMENT_FORM);case LEFT_CURLY:return e=new Node(a,blockInit()),Statements(a,b.update({parentBlock:e}).pushTarget(e).nest(),e),a.mustMatch(RIGHT_CURLY),e;case IF:return e=new Node(a),e.condition=HeadExpression(a,b),l=b.pushTarget(e).nest(),e.thenPart=Statement(a,l),e.elsePart=a.match(ELSE,!0)?Statement(a,l):null,e;case SWITCH:e=new Node(a,{cases:[],defaultIndex:-1}),e.discriminant=HeadExpression(a,b),l=b.pushTarget(e).nest(),a.mustMatch(LEFT_CURLY);while((j=a.get())!==RIGHT_CURLY){switch(j){case DEFAULT:if(e.defaultIndex>=0)throw a.newSyntaxError("More than one switch default");case CASE:f=new Node(a),j===DEFAULT?e.defaultIndex=e.cases.length:f.caseLabel=Expression(a,l,COLON);break;default:throw a.newSyntaxError("Invalid switch case")}a.mustMatch(COLON),f.statements=new Node(a,blockInit());while((j=a.peek(!0))!==CASE&&j!==DEFAULT&&j!==RIGHT_CURLY)f.statements.push(Statement(a,l));e.cases.push(f)}return e;case FOR:e=new Node(a,LOOP_INIT),a.match(IDENTIFIER)&&(a.token.value==="each"?e.isEach=!0:a.unget()),b.parenFreeMode||a.mustMatch(LEFT_PAREN),l=b.pushTarget(e).nest(),m=b.update({inForLoopInit:!0}),f=null,(j=a.peek(!0))!==SEMICOLON&&(j===VAR||j===CONST?(a.get(),f=Variables(a,m)):j===LET?(a.get(),a.peek()===LEFT_PAREN?f=LetBlock(a,m,!1):(m.parentBlock=e,e.varDecls=[],f=Variables(a,m))):f=Expression(a,m));if(f&&a.match(IN)){e.type=FOR_IN,e.object=Expression(a,m);if(f.type===VAR||f.type===LET){h=f.children;if(h.length!==1&&f.destructurings.length!==1)throw new SyntaxError("Invalid for..in left-hand side",a.filename,f.lineno);f.destructurings.length>0?e.iterator=f.destructurings[0]:e.iterator=h[0],e.varDecl=f}else{if(f.type===ARRAY_INIT||f.type===OBJECT_INIT)f.destructuredNames=checkDestructuring(a,m,f);e.iterator=f}}else{m.inForLoopInit=!1,e.setup=f,a.mustMatch(SEMICOLON);if(e.isEach)throw a.newSyntaxError("Invalid for each..in loop");e.condition=a.peek(!0)===SEMICOLON?null:Expression(a,m),a.mustMatch(SEMICOLON),k=a.peek(!0),e.update=(b.parenFreeMode?k===LEFT_CURLY||definitions.isStatementStartCode[k]:k===RIGHT_PAREN)?null:Expression(a,m)}return b.parenFreeMode||a.mustMatch(RIGHT_PAREN),e.body=Statement(a,l),e;case WHILE:return e=new Node(a,{isLoop:!0}),e.condition=HeadExpression(a,b),e.body=Statement(a,b.pushTarget(e).nest()),e;case DO:e=new Node(a,{isLoop:!0}),e.body=Statement(a,b.pushTarget(e).nest()),a.mustMatch(WHILE),e.condition=HeadExpression(a,b);if(!b.ecmaStrictMode)return a.match(SEMICOLON),e;break;case BREAK:case CONTINUE:e=new Node(a),l=b.pushTarget(e),a.peekOnSameLine()===IDENTIFIER&&(a.get(),e.label=a.token.value),e.label?e.target=l.labeledTargets.find(function(a){return a.labels.has(e.label)}):j===CONTINUE?e.target=l.defaultLoopTarget:e.target=l.defaultTarget;if(!e.target)throw a.newSyntaxError("Invalid "+(j===BREAK?"break":"continue"));if(!e.target.isLoop&&j===CONTINUE)throw a.newSyntaxError("Invalid continue");break;case TRY:e=new Node(a,{catchClauses:[]}),e.tryBlock=Block(a,b);while(a.match(CATCH)){f=new Node(a),g=MaybeLeftParen(a,b);switch(a.get()){case LEFT_BRACKET:case LEFT_CURLY:a.unget(),f.varName=DestructuringExpression(a,b,!0);break;case IDENTIFIER:f.varName=a.token.value;break;default:throw a.newSyntaxError("missing identifier in catch")}if(a.match(IF)){if(b.ecma3OnlyMode)throw a.newSyntaxError("Illegal catch guard");if(e.catchClauses.length&&!e.catchClauses.top().guard)throw a.newSyntaxError("Guarded catch after unguarded");f.guard=Expression(a,b)}MaybeRightParen(a,g),f.block=Block(a,b),e.catchClauses.push(f)}a.match(FINALLY)&&(e.finallyBlock=Block(a,b));if(!e.catchClauses.length&&!e.finallyBlock)throw a.newSyntaxError("Invalid try statement");return e;case CATCH:case FINALLY:throw a.newSyntaxError(definitions.tokens[j]+" without preceding try");case THROW:e=new Node(a),e.exception=Expression(a,b);break;case RETURN:e=ReturnOrYield(a,b);break;case WITH:return e=new Node(a),e.object=HeadExpression(a,b),e.body=Statement(a,b.pushTarget(e).nest()),e;case VAR:case CONST:e=Variables(a,b);break;case LET:a.peek()===LEFT_PAREN?e=LetBlock(a,b,!0):e=Variables(a,b);break;case DEBUGGER:e=new Node(a);break;case NEWLINE:case SEMICOLON:return e=new Node(a,{type:SEMICOLON}),e.expression=null,e;default:if(j===IDENTIFIER){j=a.peek();if(j===COLON){d=a.token.value;if(b.allLabels.has(d))throw a.newSyntaxError("Duplicate label");return a.get(),e=new Node(a,{type:LABEL,label:d}),e.statement=Statement(a,b.pushLabel(d).nest()),e.target=e.statement.type===LABEL?e.statement.target:e.statement,e}}e=new Node(a,{type:SEMICOLON}),a.unget(),e.expression=Expression(a,b),e.end=e.expression.end}return MagicalSemicolon(a),e}function MagicalSemicolon(a){var b;if(a.lineno===a.token.lineno){b=a.peekOnSameLine();if(b!==END&&b!==NEWLINE&&b!==SEMICOLON&&b!==RIGHT_CURLY)throw a.newSyntaxError("missing ; before statement")}a.match(SEMICOLON)}function ReturnOrYield(a,b){var c,d,e=a.token.type,f,g=b.parentScript;if(e===RETURN){if(!b.inFunction)throw a.newSyntaxError("Return not in function")}else{if(!b.inFunction)throw a.newSyntaxError("Yield not in function");g.isGenerator=!0}c=new Node(a,{value:undefined}),f=e===RETURN?a.peekOnSameLine(!0):a.peek(!0),f!==END&&f!==NEWLINE&&f!==SEMICOLON&&f!==RIGHT_CURLY&&(e!==YIELD||f!==e&&f!==RIGHT_BRACKET&&f!==RIGHT_PAREN&&f!==COLON&&f!==COMMA)?e===RETURN?(c.value=Expression(a,b),g.hasReturnWithValue=!0):c.value=AssignExpression(a,b):e===RETURN&&(g.hasEmptyReturn=!0);if(g.hasReturnWithValue&&g.isGenerator)throw a.newSyntaxError("Generator returns a value");return c}function ModuleExpression(a,b){return a.match(STRING)?new Node(a):QualifiedPath(a,b)}function ImportPathList(a,b){var c=[];do c.push(ImportPath(a,b));while(a.match(COMMA));return c}function ImportPath(a,b){var c=QualifiedPath(a,b);if(!a.match(DOT)){if(c.type===IDENTIFIER)throw a.newSyntaxError("cannot import local variable");return c}var d=new Node(a);return d.push(c),d.push(ImportSpecifierSet(a,b)),d}function ExplicitSpecifierSet(a,b,c){var d,e,f,g;d=new Node(a,{type:OBJECT_INIT}),a.mustMatch(LEFT_CURLY);if(!a.match(RIGHT_CURLY))do f=Identifier(a,b),a.match(COLON)?(e=new Node(a,{type:PROPERTY_INIT}),e.push(f),e.push(c(a,b)),d.push(e)):d.push(f);while(!a.match(RIGHT_CURLY)&&a.mustMatch(COMMA));return d}function ImportSpecifierSet(a,b){return a.match(MUL)?new Node(a,{type:IDENTIFIER,name:"*"}):ExplicitSpecifierSet(a,b,Identifier)}function Identifier(a,b){return a.mustMatch(IDENTIFIER),new Node(a,{type:IDENTIFIER})}function QualifiedPath(a,b){var c,d;c=Identifier(a,b);while(a.match(DOT)){if(a.peek()!==IDENTIFIER){a.unget();break}d=new Node(a),d.push(c),d.push(Identifier(a,b)),c=d}return c}function ExportPath(a,b){return a.peek()===LEFT_CURLY?ExplicitSpecifierSet(a,b,QualifiedPath):QualifiedPath(a,b)}function ExportPathList(a,b){var c=[];do c.push(ExportPath(a,b));while(a.match(COMMA));return c}function FunctionDefinition(a,b,c,d){var e,f=new Node(a,{params:[]});f.type!==FUNCTION&&(f.type=f.value==="get"?GETTER:SETTER);if(a.match(IDENTIFIER))f.name=a.token.value;else if(c)throw a.newSyntaxError("missing function identifier");var g=b?b.inModule:!1,h=new StaticContext(null,null,g,!0);a.mustMatch(LEFT_PAREN);if(!a.match(RIGHT_PAREN)){do switch(a.get()){case LEFT_BRACKET:case LEFT_CURLY:a.unget(),f.params.push(DestructuringExpression(a,h));break;case IDENTIFIER:f.params.push(a.token.value);break;default:throw a.newSyntaxError("missing formal parameter")}while(a.match(COMMA));a.mustMatch(RIGHT_PAREN)}e=a.get(),e!==LEFT_CURLY&&a.unget();if(e!==LEFT_CURLY){f.body=AssignExpression(a,h);if(f.body.isGenerator)throw a.newSyntaxError("Generator returns a value")}else f.body=Script(a,g,!0);return e===LEFT_CURLY&&a.mustMatch(RIGHT_CURLY),f.end=a.token.end,f.functionForm=d,d===DECLARED_FORM&&b.parentScript.funDecls.push(f),f}function ModuleVariables(a,b,c){var d,e;do d=Identifier(a,b),a.match(ASSIGN)&&(e=ModuleExpression(a,b),d.initializer=e,e.type===STRING?b.parentScript.modLoads.set(d.value,e.value):b.parentScript.modAssns.set(d.value,d)),c.push(d);while(a.match(COMMA))}function Variables(a,b,c){var d,e,f,g,h,i;i=a.token.type;switch(i){case VAR:case CONST:h=b.parentScript;break;case LET:h=b.parentBlock;break;case LEFT_PAREN:i=LET,h=c}d=new Node(a,{type:i,destructurings:[]});do{i=a.get();if(i===LEFT_BRACKET||i===LEFT_CURLY){a.unget();var j=DestructuringExpression(a,b,!0);e=new Node(a,{type:IDENTIFIER,name:j,readOnly:d.type===CONST}),d.push(e),pushDestructuringVarDecls(e.name.destructuredNames,h),d.destructurings.push({exp:j,decl:e});if(b.inForLoopInit&&a.peek()===IN)continue;a.mustMatch(ASSIGN);if(a.token.assignOp)throw a.newSyntaxError("Invalid variable initialization");e.initializer=AssignExpression(a,b);continue}if(i!==IDENTIFIER)throw a.newSyntaxError("missing variable name");e=new Node(a,{type:IDENTIFIER,name:a.token.value,readOnly:d.type===CONST}),d.push(e),h.varDecls.push(e);if(a.match(ASSIGN)){if(a.token.assignOp)throw a.newSyntaxError("Invalid variable initialization");e.initializer=AssignExpression(a,b)}}while(a.match(COMMA));return d}function LetBlock(a,b,c){var d,e;return d=new Node(a,{type:LET_BLOCK,varDecls:[]}),a.mustMatch(LEFT_PAREN),d.variables=Variables(a,b,d),a.mustMatch(RIGHT_PAREN),c&&a.peek()!==LEFT_CURLY&&(e=new Node(a,{type:SEMICOLON,expression:d}),c=!1),c?d.block=Block(a,b):d.expression=AssignExpression(a,b),d}function checkDestructuring(a,b,c,d){if(c.type===ARRAY_COMP)throw a.newSyntaxError("Invalid array comprehension left-hand side");if(c.type!==ARRAY_INIT&&c.type!==OBJECT_INIT)return;var e={},f,g,h,i,j,k=c.children;for(var l=0,m=k.length;l<m;l++){if(!(f=k[l]))continue;f.type===PROPERTY_INIT?(j=f.children,i=j[1],h=j[0].value):c.type===OBJECT_INIT?(i=f,h=f.value):(i=f,h=l);if(i.type===ARRAY_INIT||i.type===OBJECT_INIT)e[h]=checkDestructuring(a,b,i,d);else{if(d&&i.type!==IDENTIFIER)throw a.newSyntaxError("missing name in pattern");e[h]=i}}return e}function DestructuringExpression(a,b,c){var d=PrimaryExpression(a,b);return d.destructuredNames=checkDestructuring(a,b,d,c),d}function GeneratorExpression(a,b,c){return new Node(a,{type:GENERATOR,expression:c,tail:ComprehensionTail(a,b)})}function ComprehensionTail(a,b){var c,d,e,f,g;c=new Node(a,{type:COMP_TAIL});do{d=new Node(a,{type:FOR_IN,isLoop:!0}),a.match(IDENTIFIER)&&(a.token.value==="each"?d.isEach=!0:a.unget()),g=MaybeLeftParen(a,b);switch(a.get()){case LEFT_BRACKET:case LEFT_CURLY:a.unget(),d.iterator=DestructuringExpression(a,b);break;case IDENTIFIER:d.iterator=f=new Node(a,{type:IDENTIFIER}),f.name=f.value,d.varDecl=e=new Node(a,{type:VAR}),e.push(f),b.parentScript.varDecls.push(f);break;default:throw a.newSyntaxError("missing identifier")}a.mustMatch(IN),d.object=Expression(a,b),MaybeRightParen(a,g),c.push(d)}while(a.match(FOR));return a.match(IF)&&(c.guard=HeadExpression(a,b)),c}function HeadExpression(a,b){var c=MaybeLeftParen(a,b),d=ParenExpression(a,b);MaybeRightParen(a,c);if(c===END&&!d.parenthesized){var e=a.peek();if(e!==LEFT_CURLY&&!definitions.isStatementStartCode[e])throw a.newSyntaxError("Unparenthesized head followed by unbraced body")}return d}function ParenExpression(a,b){var c=Expression(a,b.update({inForLoopInit:b.inForLoopInit&&a.token.type===LEFT_PAREN}));if(a.match(FOR)){if(c.type===YIELD&&!c.parenthesized)throw a.newSyntaxError("Yield expression must be parenthesized");if(c.type===COMMA&&!c.parenthesized)throw a.newSyntaxError("Generator expression must be parenthesized");c=GeneratorExpression(a,b,c)}return c}function Expression(a,b){var c,d;c=AssignExpression(a,b);if(a.match(COMMA)){d=new Node(a,{type:COMMA}),d.push(c),c=d;do{d=c.children[c.children.length-1];if(d.type===YIELD&&!d.parenthesized)throw a.newSyntaxError("Yield expression must be parenthesized");c.push(AssignExpression(a,b))}while(a.match(COMMA))}return c}function AssignExpression(a,b){var c,d;if(a.match(YIELD,!0))return ReturnOrYield(a,b);c=new Node(a,{type:ASSIGN}),d=ConditionalExpression(a,b);if(!a.match(ASSIGN))return d;switch(d.type){case OBJECT_INIT:case ARRAY_INIT:d.destructuredNames=checkDestructuring(a,b,d);case IDENTIFIER:case DOT:case INDEX:case CALL:break;default:throw a.newSyntaxError("Bad left-hand side of assignment")}return c.assignOp=a.token.assignOp,c.push(d),c.push(AssignExpression(a,b)),c}function ConditionalExpression(a,b){var c,d;c=OrExpression(a,b);if(a.match(HOOK)){d=c,c=new Node(a,{type:HOOK}),c.push(d),c.push(AssignExpression(a,b.update({inForLoopInit:!1})));if(!a.match(COLON))throw a.newSyntaxError("missing : after ?");c.push(AssignExpression(a,b))}return c}function OrExpression(a,b){var c,d;c=AndExpression(a,b);while(a.match(OR))d=new Node(a),d.push(c),d.push(AndExpression(a,b)),c=d;return c}function AndExpression(a,b){var c,d;c=BitwiseOrExpression(a,b);while(a.match(AND))d=new Node(a),d.push(c),d.push(BitwiseOrExpression(a,b)),c=d;return c}function BitwiseOrExpression(a,b){var c,d;c=BitwiseXorExpression(a,b);while(a.match(BITWISE_OR))d=new Node(a),d.push(c),d.push(BitwiseXorExpression(a,b)),c=d;return c}function BitwiseXorExpression(a,b){var c,d;c=BitwiseAndExpression(a,b);while(a.match(BITWISE_XOR))d=new Node(a),d.push(c),d.push(BitwiseAndExpression(a,b)),c=d;return c}function BitwiseAndExpression(a,b){var c,d;c=EqualityExpression(a,b);while(a.match(BITWISE_AND))d=new Node(a),d.push(c),d.push(EqualityExpression(a,b)),c=d;return c}function EqualityExpression(a,b){var c,d;c=RelationalExpression(a,b);while(a.match(EQ)||a.match(NE)||a.match(STRICT_EQ)||a.match(STRICT_NE))d=new Node(a),d.push(c),d.push(RelationalExpression(a,b)),c=d;return c}function RelationalExpression(a,b){var c,d,e=b.update({inForLoopInit:!1});c=ShiftExpression(a,e);while(a.match(LT)||a.match(LE)||a.match(GE)||a.match(GT)||!b.inForLoopInit&&a.match(IN)||a.match(INSTANCEOF))d=new Node(a),d.push(c),d.push(ShiftExpression(a,e)),c=d;return c}function ShiftExpression(a,b){var c,d;c=AddExpression(a,b);while(a.match(LSH)||a.match(RSH)||a.match(URSH))d=new Node(a),d.push(c),d.push(AddExpression(a,b)),c=d;return c}function AddExpression(a,b){var c,d;c=MultiplyExpression(a,b);while(a.match(PLUS)||a.match(MINUS))d=new Node(a),d.push(c),d.push(MultiplyExpression(a,b)),c=d;return c}function MultiplyExpression(a,b){var c,d;c=UnaryExpression(a,b);while(a.match(MUL)||
a.match(DIV)||a.match(MOD))d=new Node(a),d.push(c),d.push(UnaryExpression(a,b)),c=d;return c}function UnaryExpression(a,b){var c,d,e;switch(e=a.get(!0)){case DELETE:case VOID:case TYPEOF:case NOT:case BITWISE_NOT:case PLUS:case MINUS:e===PLUS?c=new Node(a,{type:UNARY_PLUS}):e===MINUS?c=new Node(a,{type:UNARY_MINUS}):c=new Node(a),c.push(UnaryExpression(a,b));break;case INCREMENT:case DECREMENT:c=new Node(a),c.push(MemberExpression(a,b,!0));break;default:a.unget(),c=MemberExpression(a,b,!0),a.tokens[a.tokenIndex+a.lookahead-1&3].lineno===a.lineno&&(a.match(INCREMENT)||a.match(DECREMENT))&&(d=new Node(a,{postfix:!0}),d.push(c),c=d)}return c}function MemberExpression(a,b,c){var d,e,f,g;a.match(NEW)?(d=new Node(a),d.push(MemberExpression(a,b,!1)),a.match(LEFT_PAREN)&&(d.type=NEW_WITH_ARGS,d.push(ArgumentList(a,b)))):d=PrimaryExpression(a,b);while((g=a.get())!==END){switch(g){case DOT:e=new Node(a),e.push(d),a.mustMatch(IDENTIFIER),e.push(new Node(a));break;case LEFT_BRACKET:e=new Node(a,{type:INDEX}),e.push(d),e.push(Expression(a,b)),a.mustMatch(RIGHT_BRACKET);break;case LEFT_PAREN:if(c){e=new Node(a,{type:CALL}),e.push(d),e.push(ArgumentList(a,b));break};default:return a.unget(),d}d=e}return d}function ArgumentList(a,b){var c,d;c=new Node(a,{type:LIST});if(a.match(RIGHT_PAREN,!0))return c;do{d=AssignExpression(a,b);if(d.type===YIELD&&!d.parenthesized&&a.peek()===COMMA)throw a.newSyntaxError("Yield expression must be parenthesized");if(a.match(FOR)){d=GeneratorExpression(a,b,d);if(c.children.length>1||a.peek(!0)===COMMA)throw a.newSyntaxError("Generator expression must be parenthesized")}c.push(d)}while(a.match(COMMA));return a.mustMatch(RIGHT_PAREN),c}function PrimaryExpression(a,b){var c,d,e=a.get(!0);switch(e){case FUNCTION:c=FunctionDefinition(a,b,!1,EXPRESSED_FORM);break;case LEFT_BRACKET:c=new Node(a,{type:ARRAY_INIT});while((e=a.peek(!0))!==RIGHT_BRACKET){if(e===COMMA){a.get(),c.push(null);continue}c.push(AssignExpression(a,b));if(e!==COMMA&&!a.match(COMMA))break}c.children.length===1&&a.match(FOR)&&(d=new Node(a,{type:ARRAY_COMP,expression:c.children[0],tail:ComprehensionTail(a,b)}),c=d),a.mustMatch(RIGHT_BRACKET);break;case LEFT_CURLY:var f,g;c=new Node(a,{type:OBJECT_INIT});h:if(!a.match(RIGHT_CURLY)){do{e=a.get();if(a.token.value!=="get"&&a.token.value!=="set"||a.peek()!==IDENTIFIER){switch(e){case IDENTIFIER:case NUMBER:case STRING:f=new Node(a,{type:IDENTIFIER});break;case RIGHT_CURLY:if(b.ecma3OnlyMode)throw a.newSyntaxError("Illegal trailing ,");break h;default:if(a.token.value in definitions.keywords){f=new Node(a,{type:IDENTIFIER});break}throw a.newSyntaxError("Invalid property name")}if(a.match(COLON))d=new Node(a,{type:PROPERTY_INIT}),d.push(f),d.push(AssignExpression(a,b)),c.push(d);else{if(a.peek()!==COMMA&&a.peek()!==RIGHT_CURLY)throw a.newSyntaxError("missing : after property");c.push(f)}}else{if(b.ecma3OnlyMode)throw a.newSyntaxError("Illegal property accessor");c.push(FunctionDefinition(a,b,!0,EXPRESSED_FORM))}}while(a.match(COMMA));a.mustMatch(RIGHT_CURLY)}break;case LEFT_PAREN:c=ParenExpression(a,b),a.mustMatch(RIGHT_PAREN),c.parenthesized=!0;break;case LET:c=LetBlock(a,b,!1);break;case NULL:case THIS:case TRUE:case FALSE:case IDENTIFIER:case NUMBER:case STRING:case REGEXP:c=new Node(a);break;default:throw a.newSyntaxError("missing operand")}return c}function parse(a,b,c){var d=new lexer.Tokenizer(a,b,c),e=Script(d,!1,!1);if(!d.done)throw d.newSyntaxError("Syntax error");return e}function parseStdin(a,b,c,d){if(a.match(/^[\s]*\.begin[\s]*$/))return++b.value,parseMultiline(b,c);d(a.trim())&&(a="");for(;;)try{var e=new lexer.Tokenizer(a,"stdin",b.value),f=Script(e,!1,!1);return b.value=e.lineno,f}catch(g){if(!e.unexpectedEOF)throw g;var h;do{c&&putstr(c),h=readline();if(!h)throw g}while(d(h.trim()));a+="\n"+h}}function parseMultiline(a,b){var c="";for(;;){b&&putstr(b);var d=readline();if(d===null)return null;if(d.match(/^[\s]*\.end[\s]*$/))break;c+="\n"+d}var e=new lexer.Tokenizer(c,"stdin",a.value),f=Script(e,!1,!1);return a.value=e.lineno,f}var lexer=Narcissus.lexer,definitions=Narcissus.definitions,StringMap=definitions.StringMap,Stack=definitions.Stack;eval(definitions.consts);var blackLists={185:{},harmony:{}};blackLists[185][IMPORT]=!0,blackLists[185][EXPORT]=!0,blackLists[185][MODULE]=!0,blackLists.harmony[WITH]=!0,StaticContext.prototype={ecma3OnlyMode:!1,parenFreeMode:!1,update:function(a){var b={};for(var c in a)b[c]={value:a[c],writable:!0,enumerable:!0,configurable:!0};return Object.create(this,b)},pushLabel:function(a){return this.update({currentLabels:this.currentLabels.push(a),allLabels:this.allLabels.push(a)})},pushTarget:function(a){var b=a.isLoop,c=b||a.type===SWITCH;return this.currentLabels.isEmpty()?(b&&this.update({defaultLoopTarget:a}),c&&this.update({defaultTarget:a}),this):(a.labels=new StringMap,this.currentLabels.forEach(function(b){a.labels.set(b,!0)}),this.update({currentLabels:new Stack,labeledTargets:this.labeledTargets.push(a),defaultLoopTarget:b?a:this.defaultLoopTarget,defaultTarget:c?a:this.defaultTarget}))},nest:function(){return this.topLevel?this.update({topLevel:!1}):this},allow:function(a){switch(a){case EXPORT:if(!this.inModule||this.inFunction||!this.topLevel)return!1;case IMPORT:return!this.inFunction&&this.topLevel;case MODULE:return!this.inFunction&&this.topLevel;default:return!0}}},definitions.defineProperty(Array.prototype,"top",function(){return this.length&&this[this.length-1]},!1,!1,!0);var Np=Node.prototype={};Np.constructor=Node,Np.toSource=Object.prototype.toSource,Np.push=function(a){return a!==null&&(a.start<this.start&&(this.start=a.start),this.end<a.end&&(this.end=a.end)),this.children.push(a)},Node.indentLevel=0,Np.toString=function(){var a=[];for(var b in this)this.hasOwnProperty(b)&&b!=="type"&&b!=="target"&&a.push({id:b,value:this[b]});a.sort(function(a,b){return a.id<b.id?-1:1});var c="    ",d=++Node.indentLevel,e="{\n"+c.repeat(d)+"type: "+tokenString(this.type);for(b=0;b<a.length;b++)e+=",\n"+c.repeat(d)+a[b].id+": "+a[b].value;return d=--Node.indentLevel,e+="\n"+c.repeat(d)+"}",e},Np.getSource=function(){return this.tokenizer.source.slice(this.start,this.end)};var LOOP_INIT={isLoop:!0};definitions.defineGetter(Np,"filename",function(){return this.tokenizer.filename}),definitions.defineGetter(Np,"length",function(){throw new Error("Node.prototype.length is gone; use n.children.length instead")}),definitions.defineProperty(String.prototype,"repeat",function(a){var b="",c=this+b;while(--a>=0)b+=c;return b},!1,!1,!0);var DECLARED_FORM=0,EXPRESSED_FORM=1,STATEMENT_FORM=2;return{parse:parse,parseStdin:parseStdin,Node:Node,DECLARED_FORM:DECLARED_FORM,EXPRESSED_FORM:EXPRESSED_FORM,STATEMENT_FORM:STATEMENT_FORM,Tokenizer:lexer.Tokenizer,FunctionDefinition:FunctionDefinition,Module:Module,Export:Export}}(),Narcissus.decompiler=function(){function indent(a,b){var c="",d=!0;for(var e=0,f=b.length;e<f;e++){if(d)for(var g=0;g<a;g++)c+=" ";c+=b[e],d=b[e]==="\n"}return c}function isBlock(a){return a&&a.type===BLOCK}function isNonEmptyBlock(a){return isBlock(a)&&a.children.length>0}function nodeStr(a){return'"'+a.value.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"'}function pp(a,b,c){var d=!1;if(!a)return"";if(a instanceof Object){b||(d=!0,b=1);var e="";a.parenthesized&&(e+="(");switch(a.type){case FUNCTION:case GETTER:case SETTER:a.type===FUNCTION?e+="function":a.type===GETTER?e+="get":e+="set",e+=(a.name?" "+a.name:"")+"(";for(var f=0,g=a.params.length;f<g;f++)e+=(f>0?", ":"")+pp(a.params[f],b);e+=") "+pp(a.body,b);break;case SCRIPT:case BLOCK:var h=a.children;if(d){for(var f=0,g=h.length;f<g;f++){f>0&&(e+="\n"),e+=pp(h[f],b);var i=e[e.length-1];i!=";"&&(e+=";")}break}e+="{",a.id!==undefined&&(e+=" /* "+a.id+" */"),e+="\n";for(var f=0,g=h.length;f<g;f++){f>0&&(e+="\n"),e+=indent(4,pp(h[f],b));var i=e[e.length-1];i!=";"&&(e+=";")}e+="\n}";break;case LET_BLOCK:e+="let ("+pp(a.variables,b,!0)+") ",a.expression?e+=pp(a.expression,b):e+=pp(a.block,b);break;case IF:e+="if ("+pp(a.condition,b)+") ";var j=a.thenPart,k=a.elsePart,l=isBlock(j)||isBlock(k);l||(e+="{\n"),e+=(l?pp(j,b):indent(4,pp(j,b)))+"\n",k&&(l?e+=" else ":e+="} else {\n",e+=(l?pp(k,b):indent(4,pp(k,b)))+"\n"),l||(e+="}");break;case SWITCH:e+="switch ("+pp(a.discriminant,b)+") {\n";for(var f=0,g=a.cases.length;f<g;f++){var m=a.cases[f];m.type===CASE?e+="  case "+pp(m.caseLabel,b)+":\n":e+="  default:\n",ps=pp(m.statements,b),e+=ps.slice(2,ps.length-2)+"\n"}e+="}";break;case FOR:e+="for ("+pp(a.setup,b)+"; "+pp(a.condition,b)+"; "+pp(a.update,b)+") ";var n=pp(a.body,b);isBlock(a.body)?a.body&&(e+=n):e+="{\n"+indent(4,n)+";\n}";break;case WHILE:e+="while ("+pp(a.condition,b)+") ";var n=pp(a.body,b);isBlock(a.body)?e+=n:e+="{\n"+indent(4,n)+";\n}";break;case FOR_IN:var o=a.varDecl;e+=a.isEach?"for each (":"for (",e+=(o?pp(o,b):pp(a.iterator,b))+" in "+pp(a.object,b)+") ";var n=pp(a.body,b);isBlock(a.body)?a.body&&(e+=n):e+="{\n"+indent(4,n)+";\n}";break;case DO:e+="do "+pp(a.body,b),e+=" while ("+pp(a.condition,b)+");";break;case BREAK:e+="break"+(a.label?" "+a.label:"")+";";break;case CONTINUE:e+="continue"+(a.label?" "+a.label:"")+";";break;case TRY:e+="try ",e+=pp(a.tryBlock,b);for(var f=0,g=a.catchClauses.length;f<g;f++){var p=a.catchClauses[f];e+=" catch ("+pp(p.varName,b)+(p.guard?" if "+pp(p.guard,b):"")+") ",e+=pp(p.block,b)}a.finallyBlock&&(e+=" finally ",e+=pp(a.finallyBlock,b));break;case THROW:e+="throw "+pp(a.exception,b);break;case RETURN:e+="return",a.value&&(e+=" "+pp(a.value,b));break;case YIELD:e+="yield",a.value.type&&(e+=" "+pp(a.value,b));break;case GENERATOR:e+=pp(a.expression,b)+" "+pp(a.tail,b);break;case WITH:e+="with ("+pp(a.object,b)+") ",e+=pp(a.body,b);break;case LET:case VAR:case CONST:var h=a.children;c||(e+=tokens[a.type]+" ");for(var f=0,g=h.length;f<g;f++){f>0&&(e+=", ");var o=h[f];e+=pp(o.name,b),o.initializer&&(e+=" = "+pp(o.initializer,b))}break;case DEBUGGER:e+="debugger NYI\n";break;case SEMICOLON:a.expression&&(e+=pp(a.expression,b)+";");break;case LABEL:e+=a.label+":\n"+pp(a.statement,b);break;case COMMA:case LIST:var h=a.children;for(var f=0,g=h.length;f<g;f++)f>0&&(e+=", "),e+=pp(h[f],b);break;case ASSIGN:var h=a.children,p=a.assignOp;e+=pp(h[0],b)+" "+(p?tokens[p]:"")+"="+" "+pp(h[1],b);break;case HOOK:var h=a.children;e+="("+pp(h[0],b)+" ? "+pp(h[1],b)+" : "+pp(h[2],b),e+=")";break;case OR:case AND:var h=a.children;e+="("+pp(h[0],b)+" "+tokens[a.type]+" "+pp(h[1],b),e+=")";break;case BITWISE_OR:case BITWISE_XOR:case BITWISE_AND:case EQ:case NE:case STRICT_EQ:case STRICT_NE:case LT:case LE:case GE:case GT:case IN:case INSTANCEOF:case LSH:case RSH:case URSH:case PLUS:case MINUS:case MUL:case DIV:case MOD:var h=a.children;e+="("+pp(h[0],b)+" "+tokens[a.type]+" "+pp(h[1],b)+")";break;case DELETE:case VOID:case TYPEOF:e+=tokens[a.type]+" "+pp(a.children[0],b);break;case NOT:case BITWISE_NOT:e+=tokens[a.type]+pp(a.children[0],b);break;case UNARY_PLUS:e+="+"+pp(a.children[0],b);break;case UNARY_MINUS:e+="-"+pp(a.children[0],b);break;case INCREMENT:case DECREMENT:a.postfix?e+=pp(a.children[0],b)+tokens[a.type]:e+=tokens[a.type]+pp(a.children[0],b);break;case DOT:var h=a.children;e+=pp(h[0],b)+"."+pp(h[1],b);break;case INDEX:var h=a.children;e+=pp(h[0],b)+"["+pp(h[1],b)+"]";break;case CALL:var h=a.children;e+=pp(h[0],b)+"("+pp(h[1],b)+")";break;case NEW:case NEW_WITH_ARGS:var h=a.children;e+="new "+pp(h[0],b),h[1]&&(e+="("+pp(h[1],b)+")");break;case ARRAY_INIT:e+="[";var h=a.children;for(var f=0,g=h.length;f<g;f++)h[f]&&(e+=pp(h[f],b)),e+=",";e+="]";break;case ARRAY_COMP:e+="["+pp(a.expression,b)+" ",e+=pp(a.tail,b),e+="]";break;case COMP_TAIL:var h=a.children;for(var f=0,g=h.length;f<g;f++)f>0&&(e+=" "),e+=pp(h[f],b);a.guard&&(e+=" if ("+pp(a.guard,b)+")");break;case OBJECT_INIT:var h=a.children;h[0]&&h[0].type===PROPERTY_INIT?e+="{\n":e+="{";for(var f=0,g=h.length;f<g;f++){f>0&&(e+=",\n");var p=h[f];if(p.type===PROPERTY_INIT){var q=p.children,r;q[0].value===""||/[^A-Za-z0-9_$]/.test(q[0].value)?r=nodeStr(q[0]):r=pp(q[0],b),e+=indent(4,r)+": "+indent(4,pp(q[1],b)).substring(4)}else e+=indent(4,pp(p,b))}e+="\n}";break;case NULL:e+="null";break;case THIS:e+="this";break;case TRUE:e+="true";break;case FALSE:e+="false";break;case IDENTIFIER:case NUMBER:case REGEXP:e+=a.value;break;case STRING:e+=nodeStr(a);break;case GROUP:e+="("+pp(a.children[0],b)+")";break;default:throw"PANIC: unknown operation "+tokens[a.type]+" "+a.toSource()}return a.parenthesized&&(e+=")"),e}return a}var parser=Narcissus.parser,definitions=Narcissus.definitions,tokens=definitions.tokens;return eval(definitions.consts),{pp:pp}}();if(typeof exports!="undefined")var Narcissus=require("../../deps/narcissus");(function(exports){function _pp(a){function e(a){return b+=1,a}function f(a,b){var c="",d=!0;for(var e=0,f=b.length;e<f;e++){if(d)for(var g=0;g<a;g++)c+=" ";c+=b[e],d=b[e]==="\n"}return c}function g(a){return a&&a.type===BLOCK}function h(a){return g(a)&&a.children.length>0}function i(a){return'"'+a.value.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"'}function j(a,d,h){var k=!1;if(!a)return"";if(a instanceof Object){d||(k=!0,d=1),c[b]||(c[b]=[]),c[b].push(a);var l="";a.parenthesized&&(l+="(");switch(a.type){case FUNCTION:case GETTER:case SETTER:a.type===FUNCTION?l+="function":a.type===GETTER?l+="get":l+="set",l+=(a.name?" "+a.name:"")+"(";for(var m=0,n=a.params.length;m<n;m++)l+=(m>0?", ":"")+j(a.params[m],d);l+=") "+j(a.body,d);break;case SCRIPT:case BLOCK:var o=a.children;if(k){for(var m=0,n=o.length;m<n;m++){m>0&&(l+=e("\n")),l+=j(o[m],d);var p=l[l.length-1];p!=";"&&(l+=";")}break}l+="{",a.id!==undefined&&(l+=" /* "+a.id+" */"),l+=e("\n");for(var m=0,n=o.length;m<n;m++){m>0&&(l+=e("\n")),l+=f(2,j(o[m],d));var p=l[l.length-1];p!=";"&&(l+=";")}l+=e("\n}");break;case LET_BLOCK:l+="let ("+j(a.variables,d,!0)+") ",a.expression?l+=j(a.expression,d):l+=j(a.block,d);break;case IF:l+="if ("+j(a.condition,d)+") ";var q=a.thenPart,r=a.elsePart,s=g(q)||g(r);s||(l+=e("{\n")),l+=s?j(q,d):f(2,j(q,d)),r&&";}".indexOf(l[l.length-1])<0&&(l+=";"),l+=e("\n"),r&&(s?l+=" else ":l+=e("} else {\n"),l+=(s?j(r,d):f(2,j(r,d)))+e("\n")),s||(l+="}");break;case SWITCH:l+="switch ("+j(a.discriminant,d)+e(") {\n");for(var m=0,n=a.cases.length;m<n;m++){var t=a.cases[m];t.type===CASE?l+="case "+j(t.caseLabel,d)+e(":\n"):l+=e("  default:\n"),ps=j(t.statements,d),l+=ps.slice(2,ps.length-2)+e("\n")}l+="}";break;case FOR:l+="for ("+j(a.setup,d)+"; "+j(a.condition,d)+"; "+j(a.update,d)+") ";var u=j(a.body,d);g(a.body)?a.body&&(l+=u):l+=e("{\n")+f(2,u)+e(";\n}");break;case WHILE:l+="while ("+j(a.condition,d)+") ";var u=j(a.body,d);g(a.body)?l+=u:l+=e("{\n")+f(2,u)+e(";\n}");break;case FOR_IN:var v=a.varDecl;l+=a.isEach?"for each (":"for (",l+=(v?j(v,d):j(a.iterator,d))+" in "+j(a.object,d)+") ";var u=j(a.body,d);g(a.body)?a.body&&(l+=u):l+=e("{\n")+f(2,u)+e(";\n}");break;case DO:l+="do "+j(a.body,d),l+=" while ("+j(a.condition,d)+");";break;case BREAK:l+="break"+(a.label?" "+a.label:"")+";";break;case CONTINUE:l+="continue"+(a.label?" "+a.label:"")+";";break;case TRY:l+="try ",l+=j(a.tryBlock,d);for(var m=0,n=a.catchClauses.length;m<n;m++){var w=a.catchClauses[m];l+=" catch ("+j(w.varName,d)+(w.guard?" if "+j(w.guard,d):"")+") ",l+=j(w.block,d)}a.finallyBlock&&(l+=" finally ",l+=j(a.finallyBlock,d));break;case THROW:l+="throw "+j(a.exception,d);break;case RETURN:l+="return",a.value&&(l+=" "+j(a.value,d));break;case YIELD:l+="yield",a.value.type&&(l+=" "+j(a.value,d));break;case GENERATOR:l+=j(a.expression,d)+" "+j(a.tail,d);break;case WITH:l+="with ("+j(a.object,d)+") ",l+=j(a.body,d);break;case LET:case VAR:case CONST:var o=a.children;h||(l+=tokens[a.type]+" ");for(var m=0,n=o.length;m<n;m++){m>0&&(l+=", ");var v=o[m];l+=j(v.name,d),v.initializer&&(l+=" = "+j(v.initializer,d))}break;case DEBUGGER:l+=e("debugger NYI\n");break;case SEMICOLON:a.expression&&(l+=j(a.expression,d)+";");break;case LABEL:l+=a.label+e(":\n")+j(a.statement,d);break;case COMMA:case LIST:var o=a.children;for(var m=0,n=o.length;m<n;m++)m>0&&(l+=", "),l+=j(o[m],d);break;case ASSIGN:var o=a.children,w=a.assignOp;l+=j(o[0],d)+" "+(w?tokens[w]:"")+"="+" "+j(o[1],d);break;case HOOK:var o=a.children;l+="("+j(o[0],d)+" ? "+j(o[1],d)+" : "+j(o[2],d),l+=")";break;case OR:case AND:var o=a.children;l+="("+j(o[0],d)+" "+tokens[a.type]+" "+j(o[1],d),l+=")";break;case BITWISE_OR:case BITWISE_XOR:case BITWISE_AND:case EQ:case NE:case STRICT_EQ:case STRICT_NE:case LT:case LE:case GE:case GT:case IN:case INSTANCEOF:case LSH:case RSH:case URSH:case PLUS:case MINUS:case MUL:case DIV:case MOD:var o=a.children;l+="("+j(o[0],d)+" "+tokens[a.type]+" "+j(o[1],d)+")";break;case DELETE:case VOID:case TYPEOF:l+=tokens[a.type]+" "+j(a.children[0],d);break;case NOT:case BITWISE_NOT:l+=tokens[a.type]+j(a.children[0],d);break;case UNARY_PLUS:l+="+"+j(a.children[0],d);break;case UNARY_MINUS:l+="-"+j(a.children[0],d);break;case INCREMENT:case DECREMENT:a.postfix?l+=j(a.children[0],d)+tokens[a.type]:l+=tokens[a.type]+j(a.children[0],d);break;case DOT:var o=a.children;l+=j(o[0],d)+"."+j(o[1],d);break;case INDEX:var o=a.children;l+=j(o[0],d)+"["+j(o[1],d)+"]";break;case CALL:var o=a.children;l+=j(o[0],d)+"("+j(o[1],d)+")";break;case NEW:case NEW_WITH_ARGS:var o=a.children;l+="new "+j(o[0],d),o[1]&&(l+="("+j(o[1],d)+")");break;case ARRAY_INIT:l+="[";var o=a.children;for(var m=0,n=o.length;m<n;m++)o[m]&&(l+=j(o[m],d)),l+=",";l+="]";break;case ARRAY_COMP:l+="["+j(a.expression,d)+" ",l+=j(a.tail,d),l+="]";break;case COMP_TAIL:var o=a.children;for(var m=0,n=o.length;m<n;m++)m>0&&(l+=" "),l+=j(o[m],d);a.guard&&(l+=" if ("+j(a.guard,d)+")");break;case OBJECT_INIT:var o=a.children;o[0]&&o[0].type===PROPERTY_INIT?l+=e("{\n"):l+="{";for(var m=0,n=o.length;m<n;m++){m>0&&(l+=e(",\n"));var w=o[m];if(w.type===PROPERTY_INIT){var x=w.children,y;/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(x[0].value)?y=j(x[0],d):y=i(x[0]),l+=f(2,y)+": "+f(2,j(x[1],d)).substring(2)}else l+=f(2,j(w,d))}l+=e("\n}");break;case NULL:l+="null";break;case THIS:l+="this";break;case TRUE:l+="true";break;case FALSE:l+="false";break;case IDENTIFIER:case NUMBER:case REGEXP:l+=a.value;break;case STRING:l+=i(a);break;case GROUP:l+="("+j(a.children[0],d)+")";break;default:throw"PANIC: unknown operation "+tokens[a.type]+" "+a.toSource()}return a.parenthesized&&(l+=")"),l}return a}var b=0,c={},d=j(a);return{source:d,lineMap:c}}eval(Narcissus.definitions.consts);var tokens=Narcissus.definitions.tokens;exports.format=function(a,b){var c="",d=_pp(a);if(b=="ignore")return d.source;var e=d.lineMap,f=d.source.split("\n");if(b=="preserve"){var g=1;for(var h=0;h<f.length;h++){var i=(e[h]||[]).filter(function(a){return a._isSourceNode});if(i.length>0){var j=i[0].lineno;while(g<j)c+="\n",g+=1}c+=f[h].replace(/^\s+/," ")}}else{if(b!="mark")throw new Error("bad --lines option: "+b);for(var h=0;h<f.length;h++){var k=f[h],i=(e[h]||[]).filter(function(a){return a._isSourceNode}),l="            ";if(i.length>0){var j=""+i[0].lineno;l="/* ";for(var m=j.length;m<5;m++)l+=" ";l+=j+" */ "}c+=l+k+"\n"}}return c}})(typeof exports!="undefined"?exports:window.Streamline=window.Streamline||{});if(typeof exports!="undefined")var Narcissus=require("../../deps/narcissus"),format=require("./format").format;else var format=Streamline.format;(function(exports){function _assert(a){if(!a)throw new Error("Assertion failed!")}function _tag(a){if(!a||!a.type)return"*NOT_A_NODE*";var b=definitions.tokens[a.type];return/^\W/.test(b)?definitions.opTypeNames[b]:b.toUpperCase()}function _node(a,b,c){return{_scope:a&&a._scope,_async:a&&a._async,type:b,children:c}}function _identifier(a,b){return{_scope:b&&b._scope,type:IDENTIFIER,name:a,value:a,initializer:b}}function _number(a){return{type:NUMBER,value:a}}function _string(a){return{type:STRING,value:a}}function _return(a){return{type:RETURN,_scope:a._scope,value:a}}function _semicolon(a){var b=_node(a,SEMICOLON);return b.expression=a,b}function _flatten(a){if(a.type==BLOCK||a.type==SCRIPT)do{var b=!1,c=[];a.children.forEach(function(d){if(d._isFunctionReference||d.type==SEMICOLON&&(d.expression==null||d.expression._isFunction))return;a._async|=d._async,d.type==BLOCK||d.type==SCRIPT?(c=c.concat(d.children),b=!0):c.push(d)}),a.children=c}while(b);return a}function _propagate(a,b,c,d){var e=d?d:a;for(var f in a)if(a.hasOwnProperty(f)&&f.indexOf("Decls")<0&&(c||f!="target")&&f[0]!="_"){var g=a[f];if(g!=null)if(Array.isArray(g)){d&&(e[f]=g=[].concat(g));var h=!1;for(var i=0;i<g.length;i++)if(c||g[i]&&g[i].type)g[i]=b(g[i],a),h|=typeof g[i]=="undefined";h&&(e[f]=g.filter(function(a){return typeof a!="undefined"}))}else if(c||g&&g.type)e[f]=b(g,a)}return e}function _clone(a){function d(a){if(!a||!a.type)return a;var e=a._cloneId;e||(e=a._cloneId=++b);var f=c[e];return f?f:(c[e]=f={_cloneId:e},_propagate(a,d,!0,f))}var b=0,c={};return _propagate(a,d,!0,{})}function Template(a,b,c,d){var e=parse("function _t(){"+b+"}").children[0].body;e.children.length==1?e=e.children[0]:e=_node(e.children[0],BLOCK,e.children),this.generate=function(b,f){function i(b){b.type!=SCRIPT&&b.type!=BLOCK&&(b._pass=a),b.type==FUNCTION&&d&&(_assert(h==null),h=b);if(!b||!b.type)return b=="_"?g.options.callback:typeof b=="string"&&b[0]==="$"?f[b]:b;b._scope=g;var c=b.type==SEMICOLON?b.expression:b;if(c&&c.type==IDENTIFIER&&c.value[0]==="$"){var e=f[c.value];return c.initializer&&(e.initializer=i(c.initializer),e.initializer._async&&(e._async=!0)),e}return b=_propagate(b,function(a){return a=i(a),a&&(a._async||d&&a===g.options.callback)&&b.type!==FUNCTION&&(b._async=!0),a},!0),b=_flatten(b),b}var g=b._scope;_assert(g!=null),f=f||{};var h=null,j=i(_clone(e));if(h){h.parenthesized=!0;var g=new Scope(h.body,h._scope.options);g.name=h._scope.name,g.line=h._scope.line,g.last=h._scope.last,_assert(h.params[0]===h._scope.options.callback),g.cbIndex=0;function k(a,b){return a.type==FUNCTION?a:(a._scope=g,_propagate(a,k))}_propagate(h,k)}return c?j.value:j},this.root=c?e.value:e}function Scope(a,b){this.script=a,this.line=0,this.last=0,this.vars=[],this.functions=[],this.options=b,this.cbIndex=-1,this.isAsync=function(){return this.cbIndex>=0}}function _genId(a){return"__"+ ++a._scope.last}function _markSource(a){function b(a){a._isSourceNode=!0,_propagate(a,function(a){return b(a),a})}b(a)}function _isScriptAsync(a,b){function d(a,e){switch(a.type){case FUNCTION:return a;case IDENTIFIER:return a.value==b.callback?c=!0:_propagate(a,d),a;default:return c||_propagate(a,d),a}}var c=!1;return _propagate(a,d),c}function _canonTopLevelScript(a,b){return a._scope=new Scope(a,b),_isScriptAsync(a,b)?_rootTemplate.generate(a,{$script:a}):a}function _guessName(a,b){function c(a){return a=a.replace(/[^A-Z0-9_$]/ig,"_o_"),a&&!/^\d/.test(a)?a:"_o_"+a}var d=_genId(a),e,f;if(b.type===IDENTIFIER)return c(b.value)+d;if(b.type===ASSIGN){e=b.children[0];var g="";while(e.type===DOT&&(f=e.children[1]).type===IDENTIFIER||e.type===INDEX&&(f=e.children[1]).type===STRING)g=g?f.value+"_"+g:f.value,e=e.children[0];e.type===IDENTIFIER&&(g=g?e.value+"_"+g:e.value);if(g)return c(g)+d}else if(b.type==PROPERTY_INIT){e=b.children[0];if(e.type===IDENTIFIER||e.type===STRING)return c(e.value)+d}return d}function _canonScopes(a,b){function c(a,d){var e=d._scope;a._scope=e;var f=e.isAsync();if(!f&&a.type!==FUNCTION){if(a.type===IDENTIFIER&&a.value===b.callback)throw new Error(a.filename+": Function contains async calls but does not have _ parameter: "+a.name+" at line "+a.lineno);return _propagate(a,c)}switch(a.type){case FUNCTION:var g=a,h=a.params.reduce(function(a,c,d){if(c!=b.callback)return a;if(a<0)return d;throw new Error("duplicate _ parameter")},-1);h>=0&&(a.name||(a.name=_guessName(a,d))),f&&(d.type===SCRIPT||d.type===BLOCK)&&(e.functions.push(a),g=undefined);var i=new Scope(a.body,b);return a.body._scope=i,i.name=a.name,i.cbIndex=h,i.line=a.lineno,a.body=_propagate(a.body,c),h>=0&&i.functions.push(_string("BEGIN_BODY")),a.body.children=i.functions.concat(a.body.children),i.hasThis&&!a._inhibitThis&&i.vars.push(_identifier("__this",_node(a,THIS))),i.hasArguments&&!a._inhibitArguments&&i.vars.push(_identifier("__arguments",_identifier("arguments"))),i.vars.length>0&&a.body.children.splice(0,0,_node(a,VAR,i.vars)),g;case VAR:var j=a.children.map(function(a){return e.vars.some(function(b){return b.value==a.value})||e.vars.push(_identifier(a.value)),a.initializer?(a=_assignTemplate.generate(d,{$lhs:_identifier(a.value),$rhs:a.initializer}),d.type===FOR&&(a=a.expression),a):null}).filter(function(a){return a!=null});if(j.length==0)return;var k=d.type==BLOCK||d.type===SCRIPT?BLOCK:COMMA,g=_node(d,k,j);return g=_propagate(g,c),d._async|=g._async,g;case THIS:return e.hasThis=!0,_identifier("__this");case IDENTIFIER:if(a.value==="arguments"){e.hasArguments=!0;if(!b.ninja)throw new Error("To use 'arguments' inside streamlined function, read the doc and set the 'ninja' option");return _identifier("__arguments")}return a=_propagate(a,c),a._async|=a.value===b.callback,d._async|=a._async,a;case CALL:_convertCoffeeScriptCalls(a,b),_convertApply(a,b);default:return a=_propagate(a,c),_setBreaks(a),d._async|=a._async,a}}return _propagate(a,c)}function _convertCoffeeScriptCalls(a,b){var c=a.children[0],d=a.children[1];if(c.type===FUNCTION&&c.params.length===0&&!c.name&&d.children.length==0)c._noFuture=!0,c.params=[b.callback],d.children=[_identifier(b.callback)];else if(c.type===DOT){var e=c.children[1];c=c.children[0],c.type===FUNCTION&&c.params.length===0&&!c.name&&e.type===IDENTIFIER&&(e.value==="call"&&d.children.length===1&&d.children[0].type===THIS?(a.children[0]=c,c._noFuture=!0,c.params=[b.callback],d.children=[_identifier(b.callback)],a._scope.hasThis=!0,c._inhibitThis=!0):e.value==="apply"&&d.children.length===2&&d.children[0].type===THIS&&d.children[1].type===IDENTIFIER&&d.children[1].value==="arguments"&&(a.children[0]=c,c._noFuture=!0,c.params=[b.callback],d.children=[_identifier(b.callback)],a._scope.hasThis=!0,a._scope.hasArguments=!0,c._inhibitThis=!0,c._inhibitArguments=!0))}}function _convertApply(a,b){var c=a.children[0],d=a.children[1];if(c.type===DOT){var e=c.children[1];if(e.type===IDENTIFIER&&e.value==="apply"&&d.children.length===2&&d.children[0].type===THIS&&d.children[1].type===IDENTIFIER&&d.children[1].value==="arguments"){var f=c.children[0];a.children[0]=_identifier("__apply"),d.children=[_identifier(b.callback),f,_identifier("__this"),_identifier("__arguments"),_number(a._scope.cbIndex)],a._scope.hasThis=!0,a._scope.hasArguments=!0}}}function _setBreaks(a){switch(a.type){case IF:a._breaks=a.thenPart._breaks&&a.elsePart&&a.elsePart._breaks;break;case SWITCH:for(var b=0;b<a.cases.length;b++){var c=a.cases[b].statements;if(a._async&&c.children.length>0&&!c._breaks)if(b==a.cases.length-2&&a.cases[b+1].type===DEFAULT&&a.cases[b+1].statements.children.length===1&&a.cases[b+1].statements.children[0].type===SEMICOLON&&a.cases[b+1].statements.children[0].expression==null)c.children.push(_node(a,BREAK)),c._breaks=!0;else if(b===a.cases.length-1)c.children.push(_node(a,BREAK)),c._breaks=!0;else throw new Error(a.filename+": unsupported construct: switch case with some path not terminated by break, return or throw")}break;case TRY:a._breaks=a.tryBlock._breaks&&a.catchClauses[0]&&a.catchClauses[0].block._breaks;break;case BLOCK:case SCRIPT:a.children.forEach(function(b){a._breaks|=b._breaks});break;case RETURN:case THROW:case BREAK:a._breaks=!0}}function _statementify(a){function c(a){a.type===COMMA?a.children.forEach(c):b.children.push(a.type==SEMICOLON?a:_semicolon(a))}if(!a)return a;var b=_node(a,BLOCK,[]);return c(a),b}function _blockify(a){if(!a||a.type==BLOCK)return a;if(a.type==COMMA)return _statementify(a);var b=_node(a,BLOCK,[a]);return b._async=a._async,b}function _canonFlows(a,b){function c(a,b){function e(a){a.condition&&a.condition._async&&a.condition.type!==CALL&&(a.condition=_flowsTemplates.CONDITION.generate(a,{$name:"__$"+a._scope.name,$condition:a.condition})),a.update&&a.update._async&&(a.update=_flowsTemplates.UPDATE.generate(a,{$name:"__$"+a._scope.name,$update:_statementify(a.update)}))}var d=a._scope;a.type==FOR&&a._pass==="flows"&&e(a);if(!d||!d.isAsync()||a._pass==="flows")return _propagate(a,c);switch(a.type){case IF:a.thenPart=_blockify(a.thenPart),a.elsePart=_blockify(a.elsePart);break;case SWITCH:if(a._async){var f=a.cases.filter(function(a){return a.type==DEFAULT})[0];f||(f=_node(a,DEFAULT),f.statements=_node(a,BLOCK,[]),a.cases.push(f)),f._breaks||f.statements.children.push(_node(a,BREAK))}break;case WHILE:a.body=_blockify(a.body),a._async&&(a=_flowsTemplates.WHILE.generate(a,{$condition:a.condition,$body:a.body}));break;case DO:a.body=_blockify(a.body),a._async&&(a=_flowsTemplates.DO.generate(a,{$firstTime:_identifier(_genId(a)),$condition:a.condition,$body:a.body}));break;case FOR:a.body=_blockify(a.body),a._async&&(a.setup?a=_flowsTemplates.FOR.generate(a,{$setup:_statementify(a.setup),$condition:a.condition,$update:a.update,$body:a.body}):a._pass!=="flows"&&(a._pass="flows",e(a)));break;case FOR_IN:a.body=_blockify(a.body);if(a._async){if(a.iterator.type!=IDENTIFIER)throw new Error("unsupported 'for ... in' syntax: type="+_tag(a.iterator));a=_flowsTemplates.FOR_IN.generate(a,{$array:_identifier(_genId(a)),$i:_identifier(_genId(a)),$object:a.object,$iter:a.iterator,$body:a.body})}break;case TRY:a._async&&a.tryBlock&&a.catchClauses[0]&&a.finallyBlock&&(a=_flowsTemplates.TRY.generate(a,{$try:a.tryBlock,$catch:a.catchClauses[0].block,$ex:a.catchClauses[0].varName,$finally:a.finallyBlock}));break;case AND:case OR:a._async&&(a=_flowsTemplates[_tag(a)].generate(a,{$name:"__$"+a._scope.name,$v:_identifier(_genId(a)),$op1:a.children[0],$op2:a.children[1]}));break;case HOOK:a._async&&(a=_flowsTemplates.HOOK.generate(a,{$name:"__$"+a._scope.name,$v:_identifier(_genId(a)),$condition:a.children[0],$true:a.children[1],$false:a.children[2]}));break;case COMMA:a._async&&(a=_flowsTemplates.COMMA.generate(a,{$name:"__$"+a._scope.name,$body:_node(a,BLOCK,a.children.slice(0,a.children.length-1).map(_semicolon)),$result:a.children[a.children.length-1]}))}return _propagate(a,c)}return _propagate(a,c)}function _split(a,b){var c=a[b];if(!c||!c._async)return a;var d=_genId(a),e=_identifier(d,c);return a[b]=_identifier(d),_node(a,BLOCK,[_node(a,VAR,[e]),a])}function _disassemble(a,b){function c(a,e,f){if(!a._async)return _propagate(a,d);a=_propagate(a,c);if(a.type===CALL){if(a.children[0].type===IDENTIFIER&&a.children[0].value.indexOf("__wrap")==0)return a._isWrapper=!0,a;var g=a.children[1];if(g.children.some(function(a){return a.type===IDENTIFIER&&a.value===b.callback||a._isWrapper})){if(f){a._scope.disassembly.push(_statementify(a));return}if(e.type==IDENTIFIER&&e.value.indexOf("__")===0)return a._skipDisassembly=!0,a;var h=_genId(a),i=_identifier(h,a);return a=_node(a,VAR,[i]),a._scope.disassembly.push(a),_identifier(h)}}return a}function d(a,b){var e=a._scope;if(!e||!e.isAsync()||!a._async)return _propagate(a,d);switch(a.type){case IF:a=_split(a,"condition");break;case SWITCH:a=_split(a,"discriminant");break;case FOR:break;case RETURN:a=_split(a,"value");break;case THROW:a=_split(a,"exception");break;case VAR:_assert(a.children.length===1);var f=a.children[0];return e.disassembly=[],f.initializer=c(f.initializer,f),a._async=f.initializer._skipDisassembly,e.disassembly.push(a),_node(b,BLOCK,e.disassembly);case SEMICOLON:return e.disassembly=[],a.expression=c(a.expression,a,!0),a.expression&&(a._async=!1,e.disassembly.push(a)),_node(b,BLOCK,e.disassembly)}return _propagate(a,d)}return _propagate(a,d)}function __func(a,b,c,d,e,f,g){if(!a)return __future.call(b,d,c,e);f.file=__srcName,f.prev=__g.frame,__g.frame=f;try{g()}catch(h){__g.setEF(h,f.prev),__propagate(a,h)}finally{__g.frame=f.prev}}function _callbackify(a,b){function c(a,b){a=_flatten(a);if(!a._scope||!a._scope.isAsync()||a._pass==="cb")return _propagate(a,c);switch(a.type){case SCRIPT:if(b._pass!=="cb"){var d;for(var f=0;f<a.children.length;f++){var g=a.children[f];if(g.type===STRING&&g.value==="BEGIN_BODY"){d=a.children.splice(0,f),a.children.splice(0,1);break}}var h=b._noFuture||b._pass==="flows"?_cbTemplates.FUNCTION_INTERNAL:_cbTemplates.FUNCTION;a=h.generate(a,{$fn:b.name,$name:"__$"+a._scope.name,$fname:_string(b.name),$line:_number(a._scope.line),$index:_number(a._scope.cbIndex),$decls:_node(a,BLOCK,d||[]),$body:a})}a.type=SCRIPT;case BLOCK:for(var i=0;i<a.children.length;i++)a.children[i]=e(a,i);return a}return _propagate(a,c)}function d(a,b){return _node(a,BLOCK,a.children.splice(b+1,a.children.length-b-1))}function e(a,e){function p(a,d,e){function g(a){return a.children.reduce(function(a,c,d){return c.type==IDENTIFIER&&c.value===b.callback||c._isWrapper?d:a},-1)}var f=
a.children[1],h=g(f);_assert(h>=0),f.children[h]._isWrapper&&(f=f.children[h].children[1],h=g(f));var i=a.start;if(b.source)while(i>=0&&b.source[i]!="\n")i--;f.children[h]=(e?e.indexOf("__")===0?_cbTemplates.CALL_TMP:_cbTemplates.CALL_RESULT:_cbTemplates.CALL_VOID).generate(a,{$v:_genId(a),$frameName:_string(a._scope.name),$offset:_number(a.lineno-a._scope.line),$col:_number(a.start-i-1),$name:"__$"+a._scope.name,$result:e,$tail:d}),a=_propagate(a,c);var j=_node(a,RETURN,[]);return j.value=a,j._pass="cb",j}var f=a.children[e];if(f._pass==="cb")return _propagate(f,c);switch(f.type){case RETURN:d(a,e);var g=f.value?_cbTemplates.RETURN:_cbTemplates.RETURN_UNDEFINED;f=g.generate(f,{$value:f.value});break;case THROW:d(a,e),f=_cbTemplates.THROW.generate(f,{$exception:f.exception});break;case BREAK:if(f.target&&!f.target._async)break;d(a,e);if(f.label)throw new Error(f.filename+": labelled break not supported yet");f=_cbTemplates.BREAK.generate(f,{});break;case CONTINUE:if(f.target&&!f.target._async)break;d(a,e);if(f.label)throw new Error(f.filename+": labelled continue not supported yet");f=_cbTemplates.CONTINUE.generate(f,{});break;default:if(f._async){var h=d(a,e);switch(f.type){case IF:f=_cbTemplates.IF.generate(f,{$name:"__$"+f._scope.name,$condition:f.condition,$then:f.thenPart,$else:f.elsePart||_node(f,BLOCK,[]),$tail:h});break;case SWITCH:f._pass="cb",f=_cbTemplates.SWITCH.generate(f,{$name:"__$"+f._scope.name,$statement:f,$tail:h});break;case FOR:var i=_identifier(_genId(f)),j=_cbTemplates.LOOP1.generate(f,{$v:i,$body:f.body}),k=f.update,l=k&&_identifier(_genId(f)),m=(k?_cbTemplates.LOOP2_UPDATE:_cbTemplates.LOOP2).generate(f,{$v:i,$condition:f.condition,$beenHere:l,$update:_statementify(k),$loop1:j});f=(k?_cbTemplates.FOR_UPDATE:_cbTemplates.FOR).generate(f,{$name:"__$"+f._scope.name,$beenHere:l,$loop2:m,$tail:h});break;case TRY:f.catchClauses[0]?f=_cbTemplates.CATCH.generate(f,{$name:"__$"+f._scope.name,$try:f.tryBlock,$catch:f.catchClauses[0].block,$ex:f.catchClauses[0].varName,$tail:h}):f=_cbTemplates.FINALLY.generate(f,{$name:"__$"+f._scope.name,$try:f.tryBlock,$finally:f.finallyBlock,$tail:h});break;case VAR:_assert(f.children.length==1);var n=f.children[0];_assert(n.type===IDENTIFIER);var o=n.initializer;return delete n.initializer,_assert(o&&o.type===CALL),p(o,h,n.value);case SEMICOLON:var o=f.expression;return _assert(o.type===CALL),p(o,h);default:throw new Error("internal error: bad node type: "+_tag(f)+": "+pp(f))}}}return c(f,a)}return _propagate(a,c)}function _checkUsed(a,b){typeof a=="string"&&a.substring(0,2)==="__"&&(b[a]=!0)}function _simplify(a,b,c){function d(a,b,c,e){var f=["parenthesized","lineno","start","end","tokenizer","hasReturnWithValue"];if(a.indexOf("_")==0||f.indexOf(a)>=0)return!0;if(b==c)return!0;if(b==null||c==null)return a=="children"&&b&&b.length===0?!0:!1;if(Array.isArray(b)){if(b.length!=c.length)return!1;for(var g=0;g<b.length;g++)if(!d(a,b[g],c[g],e))return!1;return!0}if(b.type===IDENTIFIER&&b.value[0]==="$"&&c.type===NUMBER)return e[b.value]=c.value,!0;if(typeof b=="string"&&b[0]=="$"&&typeof c=="string")return e[b]=c,!0;if(b.type){var h;if(b.type==SCRIPT&&b.children[0]&&(h=b.children[0].expression)&&typeof h.value=="string"&&h.value[0]=="$")return e[h.value]=c,!0;if(b.type!=c.type)return!1;if(b.type==IDENTIFIER&&b.value=="$")return e[b.value]=c.value,!0;for(var a in b)if(b.hasOwnProperty(a)&&a.indexOf("Decls")<0&&a!="target"&&!d(a,b[a],c[a],e))return!1;return!0}return!1}if(a._simplified)return a;a._simplified=!0,_propagate(a,function(a){return _simplify(a,b,c)}),_checkUsed(a.value,c);var e={};return d("",_optims.function__0$fn,a,e)?_identifier(e.$fn):!d("",_optims.function$return,a,e)||e.$fn1!=="___"&&e.$fn1.indexOf("__$")!==0||e.$fn2!=="__break"?d("",_optims.function__0$arg1return_null$arg2,a,e)&&e.$arg1==e.$arg2?_identifier("_"):b.optimize&&d("",_optims.__cb__,a,e)?_identifier("_"):!d("",_optims.function$fn,a,e)||e.$fn1!=="___"&&e.$fn1.indexOf("__$")!==0||e.$fn2!=="_"&&e.$fn2!=="__then"&&e.$fn2!=="__loop"?(_flatten(a),a):_identifier(e.$fn2):_identifier(e.$fn2)}function __cb(a,b,c,d,e){b.offset=c,b.col=d;var f=__g.context;return function g(c,d){var g=__g.frame;__g.frame=b,__g.context=f;try{return c?(__g.setEF(c,b),a(c)):e(null,d)}catch(h){return __g.setEF(h,b),__propagate(a,h)}finally{__g.frame=g}}}function __future(a,b,c){var d,e,f,g=function(a,b){d=!0,e=a,f=b};return b=Array.prototype.slice.call(b),b[c]=function(a,b){g(a,b)},a.apply(this,b),function(a){d?a.call(this,e,f):g=a.bind(this)}.bind(this)}function __propagate(a,b){try{a(b)}catch(c){__trap(c)}}function __trap(a){a&&(__g.context&&__g.context.errorHandler?__g.context.errorHandler(a):console.error("UNCAUGHT EXCEPTION: "+a.message+"\n"+a.stack))}function __tryCatch(a,b){try{b()}catch(c){try{a(c)}catch(d){__trap(d)}}}function __forIn(a){var b=[];for(var c in a)b.push(c);return b}function __apply(a,b,c,d,e){return a==null?__future(__apply,arguments,0):(d[e!=null?e:d.length]=a,b.apply(c,d))}function _extend(a,b){for(var c in b)a[c]=b[c];return a}function _cl(a){return _extend({},a)}function _trim(a){return a.toString().replace(/\s+/g," ")}var parse=Narcissus.parser.parse,pp=Narcissus.decompiler.pp,definitions=Narcissus.definitions;eval(definitions.consts.replace(/const /g,"var ")),exports.propagate=_propagate,exports.Template=Template;var _rootTemplate=new Template("root","(function main(_){ $script }).call(this, __trap);"),_assignTemplate=new Template("canon","$lhs = $rhs;"),_flowsTemplates={WHILE:new Template("flows","{\tfor (; $condition;) {\t\t$body;\t}}"),DO:new Template("flows","{\tvar $firstTime = true;\tfor (; $firstTime || $condition;) {\t\t$firstTime = false;\t\t$body;\t}}"),FOR:new Template("flows","{\t$setup;\tfor (; $condition; $update) {\t\t$body;\t}}"),FOR_IN:new Template("flows","{\tvar $array = __forIn($object);\tvar $i = 0;\tfor (; $i < $array.length;) {\t\t$iter = $array[$i++];\t\t$body;\t}}"),TRY:new Template("flows","try {\ttry { $try; }\tcatch ($ex) { $catch; }}finally { $finally; }"),AND:new Template("flows","return (function $name(_){\tvar $v = $op1;\tif (!$v) {\t\treturn $v;\t}\treturn $op2;})(_)",!0,!0),OR:new Template("flows","return (function $name(_){\tvar $v = $op1;\tif ($v) {\t\treturn $v;\t}\treturn $op2;})(_)",!0,!0),HOOK:new Template("flows","return (function $name(_){\tvar $v = $condition;\tif ($v) {\t\treturn $true;\t}\treturn $false;})(_);",!0,!0),COMMA:new Template("flows","return (function $name(_){\t$body;\treturn $result;})(_);",!0,!0),CONDITION:new Template("flows","return (function $name(_){\treturn $condition;})(_);",!0,!0),UPDATE:new Template("flows","return (function $name(_){\t$update;})(_);",!0,!0)},_cbTemplates={FUNCTION:new Template("cb","{\t$decls;\tvar __frame = { name: $fname, line: $line };\treturn __func(_, this, arguments, $fn, $index, __frame, function $name(){\t\t$body;\t\t_();\t});}"),FUNCTION_INTERNAL:new Template("cb","{ $decls; $body; _(); }"),RETURN:new Template("cb","return _(null, $value);"),RETURN_UNDEFINED:new Template("cb","return _(null);"),THROW:new Template("cb","return _($exception);"),IF:new Template("cb","return (function $name(__then){\tif ($condition) { $then; __then(); }\telse { $else; __then(); }})(function $name(){ $tail; });"),SWITCH:new Template("cb","return (function $name(__break){\t$statement;})(function $name(){ $tail; });"),BREAK:new Template("cb","return __break();"),CONTINUE:new Template("cb","while (__more) { __loop(); } __more = true;return;"),LOOP1:new Template("cb","if ($v) {\t$body;\twhile (__more) { __loop(); } __more = true;}else { __break(); }"),LOOP2:new Template("temp","var $v = $condition; $loop1;"),LOOP2_UPDATE:new Template("temp","if ($beenHere) { $update; } else { $beenHere = true; }var $v = $condition; $loop1;"),FOR:new Template("cb","return (function ___(__break){\tvar __more;\tvar __loop = __cb(_, __frame, 0, 0, function $name(){\t\t__more = false;\t\t$loop2\t});\tdo { __loop(); } while (__more); __more = true;})(function $name(){ $tail;});"),FOR_UPDATE:new Template("cb","var $beenHere = false;return (function ___(__break){\tvar __more;\tvar __loop = __cb(_, __frame, 0, 0, function $name(){\t\t__more = false;\t\t$loop2\t});\tdo { __loop(); } while (__more); __more = true;})(function $name(){ $tail; });"),CATCH:new Template("cb","return (function ___(__then){\t(function ___(_){\t\t__tryCatch(_, function $name(){ $try; __then(); });\t})(function ___($ex, __result){\t\t__tryCatch(_, function $name(){\t\t\tif ($ex) { $catch; __then(); }\t\t\telse { _(null, __result); }\t\t});\t});})(function ___(){\t__tryCatch(_, function $name(){ $tail; });});"),FINALLY:new Template("cb","return (function ___(__then){\t(function ___(_){\t\t__tryCatch(_, function $name(){ $try; _(null, null, true); });\t})(function ___(__e, __r, __cont){\t\t(function ___(__then){\t\t\t__tryCatch(_, function $name(){ $finally; __then(); });\t\t})(function ___(){\t\t\t__tryCatch(_, function ___(){\t\t\t\tif (__cont) __then(); else _(__e, __r);\t\t\t});\t\t})\t});})(function ___(){\t__tryCatch(_, function $name(){ $tail; });});"),CALL_VOID:new Template("cb","return __cb(_, __frame, $offset, $col, function $name(){ $tail; })",!0),CALL_TMP:new Template("cb","return __cb(_, __frame, $offset, $col, function ___(__0, $result){ $tail })",!0),CALL_RESULT:new Template("cb","return __cb(_, __frame, $offset, $col, function $name(__0, $v){\tvar $result = $v;\t$tail})",!0)},_optims={function__0$fn:(new Template("simplify","return function ___(__0) { $fn(); }",!0)).root,function$return:(new Template("simplify","return function $fn1() { return $fn2(); }",!0)).root,function__0$arg1return_null$arg2:(new Template("simplify","return function ___(__0, $arg1) { return _(null, $arg2); }",!0)).root,__cb__:(new Template("simplify","return __cb(_, $frameVar, $line, $col, _)",!0)).root,function$fn:(new Template("simplify","return function $fn1() { $fn2(); }",!0)).root},__g="var __g=typeof global!=='undefined'?global:window;__g=(__g.__streamline||(__g.__streamline={}));__g.setEF=__g.setEF||function(e,f){e.__frame = e.__frame||f};";exports.transform=function(a,b){b=b?_cl(b):{};var c;if(!b.alreadyParsed){var d=/streamline\.options\s*=\s*(\{.*\})/.exec(a);d?_extend(b,JSON.parse(d[1])):a.indexOf("pragma streamline.extraTryCatch")>=0&&(b.tryCatch="pedantic"),b.source=a,c=parse(a+"\n")}else c=a;b.callback=b.callback||"_",b.tryCatch=b.tryCatch||"safe",b.lines=b.lines||"mark";var e=c.children[0]&&c.children[0].expression&&c.children[0].expression.value=="use strict";e&&c.children.splice(0,1),_markSource(c),c=_canonTopLevelScript(c,b),c=_canonScopes(c,b),c=_canonFlows(c,b),c=_disassemble(c,b),c=_callbackify(c,b);var f={};c=_simplify(c,b,f);var g=format(c,b.lines);return b.noHelpers||(g=exports.helpersSource(b,f,e)+g),g},exports.helpersSource=function(a,b,c){var d=a.sourceName+"_.js",e=d.indexOf("node_modules/");d=e>=0?d.substring(e+13):d;var f=a.lines=="preserve"?" ":"\n";return c=c?'"use strict";'+f:"",b.__propagate=b.__propagate||b.__func,b.__trap=b.__trap||b.__propagate||b.__tryCatch,b.__future=b.__future||b.__func||b.__apply,f+c+__g+("var __srcName='"+d+"';")+(!b||b.__func?f+_trim(__func):"")+(!b||b.__cb?f+_trim(__cb):"")+(!b||b.__future?f+_trim(__future):"")+(!b||b.__propagate?f+_trim(__propagate):"")+(!b||b.__trap?f+_trim(__trap):"")+(!b||b.__tryCatch?f+_trim(__tryCatch):"")+(!b||b.__forIn?f+_trim(__forIn):"")+(!b||b.__apply?f+_trim(__apply):"")+f},exports.version="0.1.44",exports.banner=function(){return"/*** Generated by streamline "+exports.version+" - DO NOT EDIT ***/"}})(typeof exports!="undefined"?exports:window.Streamline=window.Streamline||{}),function(){function compile(a,b){b=b||{};var c=b.translations,d=b.wait||"wait";a.substr(0,13).toLowerCase()=="#coffeescript"?(a="main = ("+d+")->\n "+a.replace(/\n/g,"\n ")+"\n return\nreturn main",a=CoffeeScript.compile(a)):a="function main("+d+") {var scene = canvas();\n"+a+"\n};\nmain",c&&c.push(a);var e=Narcissus.parser.parse(a,"~",1);return e=implementOperatorOverloading(e),c&&c.push(Narcissus.decompiler.pp(e)),a=Streamline.transform(e,{alreadyParsed:!0,callback:d}),c&&c.push(a),a}function implementOperatorOverloading(program){function overload(a){if(a.children[0]&&a.children[0].value==="no overloading")return a;a=propagate(a,overload);if(a.type==definitions.UNARY_MINUS)a._scope={},a=unaryTemplate.generate(a,{$op:"-u",$value:a.children[0]});else{var b=ops[a.type];b!==undefined&&(a._scope={},a=opTemplate.generate(a,{$op:b,$lhs:a.children[0],$rhs:a.children[1]}))}return a}var propagate=Streamline.propagate,Template=Streamline.Template,definitions=eval("var definitions = {"+Narcissus.definitions.consts.replace(/const |;/g,"").replace(/=/g,":")+"}; definitions"),ops={};ops[definitions.PLUS]="+",ops[definitions.MINUS]="-",ops[definitions.MUL]="*",ops[definitions.DIV]="/";var opTemplate=new Template("binary",'return ($lhs)["$op"]($rhs)',!0),unaryTemplate=new Template("unary",'return ($value)["$op"]()',!0);return overload(program)}"use strict",window.glowscript_compile=compile}()/*This is a combined, compressed file.  Look at https://bitbucket.org/davidscherer/glowscript for source code and copyright information.*/
;(function(){})();